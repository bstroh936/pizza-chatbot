{"ast":null,"code":"import _classCallCheck from\"C:\\\\Users\\\\TheTOP\\\\Documents\\\\GitHub\\\\pizza-chatbot-chk4\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\TheTOP\\\\Documents\\\\GitHub\\\\pizza-chatbot-chk4\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import Pizza from'./Pizza';import PizzaMenu from'./itemMenu';var PizzaOrder=/*#__PURE__*/function(){function PizzaOrder(props){_classCallCheck(this,PizzaOrder);if(props==='new'){this.Cancel('order');}else{this.CreateOrder(props);}this.getSpecial=false;}_createClass(PizzaOrder,[{key:\"ProcessStep\",value:function ProcessStep(props){var stepKey=props.key;var triggerValue=props.trigger;var userMsg=this.getUserMsg(triggerValue);this.stepsProcessed++;var bot=\"Step-\".concat(this.stepsProcessed,\": \").concat(stepKey.substring(0,5));this.botKeys.push(bot);return{userMsg:userMsg,trigger:this.newTrigger,key:bot};}},{key:\"GetDisplayStep\",value:function GetDisplayStep(){if(this.currentStepInfo===null||this.triggerValue===null)return null;this.currentStepInfo=this.CreateStep(this.triggerValue);return this.currentStepInfo;}},{key:\"CurrentStepSelection\",value:function CurrentStepSelection(props){if((props.owner.name==='crusts'||props.owner.name==='sizes')&&this.SelectionArray(props.owner.name).length===0){var trig=props.target.name==='remove'||props.target.name==='cancel'||props.hasOwnProperty('btnCapt')&&props.btnCapt.indexOf('Prev')!==-1?true:false;return trig;}return true;}},{key:\"getUserMsg\",value:function getUserMsg(props){//returns the user message to the custom step\nthis.triggerValue=props;var isPrev=props.hasOwnProperty('btnCapt')&&props.btnCapt.indexOf('Prev')!==-1;switch(props.target.type){case'new'://add new pizza\nthis.SavePizzaToOrder();this.triggerValue=this.CreateNewPizza(props.owner);return'Add a new pizza to the order';case'edit'://handle edits\nreturn this.HandelEdit(props);case'menu':return isPrev?\"Go back to \".concat(this.menu.getPrev(props.owner.name)):this.CreateItemMsg(props.owner.name);case'review':this.ResetTrigger();return props.target.name==='order'?'Review pizza order':'Review pizza';case'special'://Going to a special step\nreturn\"Go to \".concat(props.owner.name);default:return this.HandleSpecialActions(props);}}},{key:\"HandelEdit\",value:function HandelEdit(props){var altTrigger=props.target.name==='specialinstmsg'||props.target.name==='ordername';this.ResetTrigger();if(altTrigger){this.newTrigger=props.target.name;var target=props.target.name==='ordername'?{type:'review',name:'order'}:{type:'edit',name:'pizza'};var owner=props.target.name==='ordername'?{type:'change',name:'ordername'}:{type:'inst',name:'specialinstmsg'};this.triggerValue={owner:owner,target:target};return props.target.name==='ordername'?'Change order name':'Change special instructions';}else if(this.menu.checkStep(props.target.name)){//menu step\nvar _target={type:'edit',name:props.target.name};var _owner={type:'edit',name:'pizza'};this.triggerValue={owner:_owner,target:_target};return\"Edit \".concat(props.target.name);}else if(props.target.name==='pizza'){return'Edit this pizza';}else{if(this.ChangeCurrentPizza(props.target.name)){var _target2={type:'edit',name:'pizza'};var _owner2={type:'review',name:'order'};this.triggerValue={owner:_owner2,target:_target2};return\"Edit Pizza #\".concat(props.target.name);}return'Invalid edit selection';}}},{key:\"CreateNewPizza\",value:function CreateNewPizza(prev){var cur={type:'menu',name:this.menu.getStep(0)};this.currentPizza=new Pizza(this.lastID+1);this.ResetTrigger();return{owner:prev,target:cur};}},{key:\"StartNewOrder\",value:function StartNewOrder(name){if(name===''){this.orderName=' ';}else{this.orderName=name;}this.currentStepInfo={current:{type:'change',name:'ordername'}};this.triggerValue=this.CreateNewPizza({type:'change',name:'ordername'});}},{key:\"SavePizzaToOrder\",value:function SavePizzaToOrder(){if(this.currentPizza===null)return null;var pizza=this.currentPizza;var id=pizza.PizzaID;var i=this.pizzas.findIndex(function(p){return p.PizzaID===id;});if(i!==-1){//Override existing pizza\nthis.pizzas.splice(i,1,pizza);}else{this.lastID=pizza.PizzaID;this.pizzas=this.pizzas.concat(pizza);}}},{key:\"EditSelections\",value:function EditSelections(type){if(this.currentPizza===null)return null;this.currentPizza.EditSelections(type);}},{key:\"AddSpecialInstructions\",value:function AddSpecialInstructions(val){if(this.currentPizza===null)return null;this.currentPizza.SpecialInstructions=val;var owner={type:'inst',name:'specialinstmsg'};var target={type:'review',name:'pizza'};this.triggerValue={owner:owner,target:target};this.getSpecial=false;}},{key:\"SelectPizzaItems\",value:function SelectPizzaItems(values){if(this.currentPizza===null)return null;var p=this.currentPizza;var ret=p.SelectPizzaItems(values);this.currentPizza=p;return ret;}},{key:\"SelectionArray\",value:function SelectionArray(type){if(this.currentPizza===null)return null;var p=this.currentPizza;var ret=p.SelectionArray(type);this.currentPizza=p;return ret;}},{key:\"ChangeCurrentPizza\",value:function ChangeCurrentPizza(id){var i=this.pizzas.findIndex(function(p){return p.PizzaID===id;});if(i!==-1){this.currentPizza=this.pizzas[i];return true;}else{return false;}}},{key:\"RemovePizza\",value:function RemovePizza(id){var i=this.pizzas.findIndex(function(p){return p.PizzaID===id;});if(i!==-1){this.pizzas.splice(i,1);this.pizzaCnt=this.pizzas.length();}if(this.currentPizza!==null&&this.currentPizza.PizzaID===id){this.CancelPizza();}var step={type:'review',name:'order'};this.currentStepInfo={current:step,prev:step,next:step};}},{key:\"StepMessage\",value:function StepMessage(props){switch(props.type){case'menu':return this.menu.getStepMessage(props.name);case'edit':return props.name==='pizza'?'Please select an option to edit':this.menu.getStepMessage(props.name);case'review':var str='Please {0} and select an option below:';return str.replace('{0}',props.name==='order'?'review your order':'review this pizza');case'complete':return'Complete this order and go to payment & confirmation?';case'cancel':return'Do you really want to cancel this order?';case'remove':return props.name==='restart'?'Are you sure you want to discard this pizza?':'Do you really want to remove this pizza?';case'change':return'Do you really want to change the name for this order?';default:return'';}}},{key:\"CreateStep\",value:function CreateStep(props){var _this=this;var next=function next(step){switch(step.type){case'menu':var chkNxt=_this.menu.getNext(step.name);var _next=chkNxt==='EOM'?'Special Instructions':chkNxt;var type=chkNxt==='EOM'?'inst':step.type;return{type:type,name:_next};case'edit':if(step.name==='save'||step.name==='drop')return{type:'review',name:'pizza'};var name=step.name.length<3?'pizza':step.name;return{type:step.type,name:name==='pizza'?_this.menu.MenuSteps.concat(['inst']):'item'};case'review':return{type:step.type,name:step.name==='order'?_this.pizzas.map(function(p){return p.PizzaID;}):'pizza'};default:return{type:'',name:''};}};var stepContents=function stepContents(step){switch(step.type){case'menu':case'edit':if(step.type==='edit'&&step.name.length<3)return{type:'review',contents:_this.CreateReview(_this.GetPizzaString(step.name))};//pizza summary\nif(step.name==='pizza'){return'';}return{type:_this.menu.getContentType(step.name),contents:{hasMulti:_this.menu.getHasMultipleSelect(step.name),elements:_this.menu.getStepElements(step.name),selected:_this.SelectionArray(step.name)}};case'review':return{type:'review',contents:_this.CreateReview(step.name)};default:return'';}};var fromReviewOrder=function fromReviewOrder(props){switch(props.owner.type){case'review':return props.owner.name==='order';case'edit':return props.isReturnFromReviewOrder;case'menu':return false;default:return false;}};var isPrev=props.hasOwnProperty('btnCapt')&&props.btnCapt.indexOf('Prev')!==-1;var chkPrev=isPrev?this.menu.getPrev(props.target.name):props.owner.name;var prevStep=chkPrev==='BOM'?'Enter Name':chkPrev;var prevType=chkPrev==='BOM'?'change':props.target.type;if(props.owner.type!=='special'){var returnStep={current:props.target,prev:{type:prevType,name:prevStep},next:next(props.target),isReturnFromReviewOrder:fromReviewOrder(props),stepMsg:this.StepMessage(props.target),stepContents:stepContents(props.target)};if(returnStep.next.type!=='inst'||returnStep.next.type!=='change'){this.ResetTrigger();}return returnStep;}else{//handle special step\nreturn{current:props.target,prev:props.owner,stepMsg:''};}}},{key:\"CreateReview\",value:function CreateReview(type){var _this2=this;if(type==='order'){var infoMap=this.pizzas.map(function(p){return p.PizzaInfo;});var cnt=infoMap.length;return{name:this.orderName,cnt:cnt,tables:infoMap.map(function(i){return _this2.CreateSummaryTable(i);})};}else{if(isNaN(type))return this.CreateSummaryTable(this.currentPizza.PizzaInfo);var i=this.pizzas.findIndex(function(p){return p.PizzaID===type;});if(i===-1){return\"No pizza \".concat(type);}var pizza=this.pizzas[i];return this.CreateSummaryTable(pizza.PizzaInfo);}}},{key:\"CreateSummaryTable\",value:function CreateSummaryTable(pizza){var _this3=this;var id=pizza.id;var items=pizza.items;var itemTypeArray=this.menu.MenuSteps;var spcinst=pizza.specinst;var stringArray=itemTypeArray.map(function(i){if(!items.hasOwnProperty(i)){return{tr:i,td:\"No \".concat(i,\" added\")};}var item=items[i];var str=_this3.getItemString(i,item);return{tr:i,td:str};});return{id:id,table:stringArray,specInst:spcinst};}},{key:\"getItemString\",value:function getItemString(type,items){var _this4=this;var retArray=items.map(function(item){if(item.id==='0'||item.id==='')return\"No \".concat(type,\" added\");var itemName=_this4.menu.GetItemName(type,item.id);var qty=item.qty!=='0'?\"\".concat(_this4.menu.GetOptMsg('qty',item.qty),\" \"):'';var half=item.half!=='0'?\" \".concat(_this4.menu.GetOptMsg('half',item.half)):'';return\"\".concat(qty).concat(itemName).concat(half);});return retArray.join(', ');}},{key:\"CreateItemMsg\",value:function CreateItemMsg(type){if(this.currentPizza===null)return null;var items=[].concat(this.currentPizza.getSelectedItems(type));if(items.length===0||items.length===1&&items[0].id===''){return\"No \".concat(type,\" added\");}return this.getItemString(type,items);}},{key:\"HandleSpecialActions\",value:function HandleSpecialActions(props){switch(props.target.type){case'complete':this.newTrigger='endmsg1';return'Complete Order';case'inst':var prev=props.owner;var next={type:'review',name:'pizza'};var cur=props.target;this.currentStepInfo={current:cur,next:next,prev:prev};this.newTrigger=props.target.name;this.getSpecial=true;return this.CreateItemMsg(props.owner.name);case'cancel':return this.Cancel(props.target.name);case'remove':return this.Remove(props.target.name);default:return'Invalid special action attempted';}}},{key:\"Remove\",value:function Remove(type){switch(type){case'restart':this.currentPizza=null;this.CreateNewPizza({type:'review',name:'order'});return'Start this pizza over';case'remove':var id=this.currentPizza.PizzaID;this.RemovePizza(id);return\"Remove pizza #\".concat(id);default:return'Invalid remove operation attempted';}}},{key:\"Cancel\",value:function Cancel(type){switch(type){case'mainpage':return'Go to main page';case'storeselect':return'Go to store selection page';case'order':this.CreateOrder({orderName:'',pizzas:[],lastID:0,currentPizza:null,stepsProcessed:0,currentStepInfo:null,botKeys:[],triggerValue:null,newTrigger:'pizzabuilder'});return'Cancel this order';default:return'Invalid cancel operation attempted';}}},{key:\"CreateOrder\",value:function CreateOrder(props){this.orderName=props.orderName;this.pizzas=props.pizzas;this.lastID=props.lastID;this.currentPizza=props.currentPizza;this.stepsProcessed=props.stepsProcessed;this.currentStepInfo=props.currentStepInfo;this.botKeys=props.botKeys;this.triggerValue=props.triggerValue;this.menu=new PizzaMenu();this.newTrigger=props.newTrigger;}},{key:\"ResetTrigger\",value:function ResetTrigger(){this.newTrigger='pizzabuilder';}}]);return PizzaOrder;}();export default PizzaOrder;","map":{"version":3,"sources":["C:/Users/TheTOP/Documents/GitHub/pizza-chatbot-chk4/src/components/PizzaOrder.jsx"],"names":["Pizza","PizzaMenu","PizzaOrder","props","Cancel","CreateOrder","getSpecial","stepKey","key","triggerValue","trigger","userMsg","getUserMsg","stepsProcessed","bot","substring","botKeys","push","newTrigger","currentStepInfo","CreateStep","owner","name","SelectionArray","length","trig","target","hasOwnProperty","btnCapt","indexOf","isPrev","type","SavePizzaToOrder","CreateNewPizza","HandelEdit","menu","getPrev","CreateItemMsg","ResetTrigger","HandleSpecialActions","altTrigger","checkStep","ChangeCurrentPizza","prev","cur","getStep","currentPizza","lastID","orderName","current","pizza","id","PizzaID","i","pizzas","findIndex","p","splice","concat","EditSelections","val","SpecialInstructions","values","ret","SelectPizzaItems","pizzaCnt","CancelPizza","step","next","getStepMessage","str","replace","chkNxt","getNext","MenuSteps","map","stepContents","contents","CreateReview","GetPizzaString","getContentType","hasMulti","getHasMultipleSelect","elements","getStepElements","selected","fromReviewOrder","isReturnFromReviewOrder","chkPrev","prevStep","prevType","returnStep","stepMsg","StepMessage","infoMap","PizzaInfo","cnt","tables","CreateSummaryTable","isNaN","items","itemTypeArray","spcinst","specinst","stringArray","tr","td","item","getItemString","table","specInst","retArray","itemName","GetItemName","qty","GetOptMsg","half","join","getSelectedItems","Remove","RemovePizza"],"mappings":"sWAAA,MAAOA,CAAAA,KAAP,KAAkB,SAAlB,CACA,MAAOC,CAAAA,SAAP,KAAsB,YAAtB,C,GAEMC,CAAAA,U,yBACJ,oBAAYC,KAAZ,CAAmB,kCACjB,GAAGA,KAAK,GAAG,KAAX,CAAiB,CACf,KAAKC,MAAL,CAAY,OAAZ,EACD,CAFD,IAEO,CACL,KAAKC,WAAL,CAAiBF,KAAjB,EACD,CACD,KAAKG,UAAL,CAAgB,KAAhB,CACD,C,uEACWH,K,CAAM,CAChB,GAAMI,CAAAA,OAAO,CAAGJ,KAAK,CAACK,GAAtB,CACA,GAAMC,CAAAA,YAAY,CAAGN,KAAK,CAACO,OAA3B,CACA,GAAMC,CAAAA,OAAO,CAAG,KAAKC,UAAL,CAAgBH,YAAhB,CAAhB,CACA,KAAKI,cAAL,GACA,GAAMC,CAAAA,GAAG,gBAAW,KAAKD,cAAhB,cAAmCN,OAAO,CAACQ,SAAR,CAAkB,CAAlB,CAAoB,CAApB,CAAnC,CAAT,CACA,KAAKC,OAAL,CAAaC,IAAb,CAAkBH,GAAlB,EACA,MAAO,CAACH,OAAO,CAACA,OAAT,CAAkBD,OAAO,CAAC,KAAKQ,UAA/B,CAA2CV,GAAG,CAACM,GAA/C,CAAP,CACD,C,uDACe,CACd,GAAG,KAAKK,eAAL,GAAuB,IAAvB,EAA6B,KAAKV,YAAL,GAAoB,IAApD,CAA0D,MAAO,KAAP,CAC1D,KAAKU,eAAL,CAAuB,KAAKC,UAAL,CAAgB,KAAKX,YAArB,CAAvB,CACA,MAAO,MAAKU,eAAZ,CACD,C,kEACoBhB,K,CAAM,CACzB,GAAG,CAACA,KAAK,CAACkB,KAAN,CAAYC,IAAZ,GAAmB,QAAnB,EAA6BnB,KAAK,CAACkB,KAAN,CAAYC,IAAZ,GAAmB,OAAjD,GAA2D,KAAKC,cAAL,CAAoBpB,KAAK,CAACkB,KAAN,CAAYC,IAAhC,EAAsCE,MAAtC,GAA+C,CAA7G,CAA+G,CAC3G,GAAMC,CAAAA,IAAI,CAAItB,KAAK,CAACuB,MAAN,CAAaJ,IAAb,GAAoB,QAApB,EAA8BnB,KAAK,CAACuB,MAAN,CAAaJ,IAAb,GAAoB,QAAlD,EAA6DnB,KAAK,CAACwB,cAAN,CAAqB,SAArB,GAAkCxB,KAAK,CAACyB,OAAN,CAAcC,OAAd,CAAsB,MAAtB,IAAgC,CAAC,CAAjI,CAAsI,IAAtI,CAA2I,KAAxJ,CACA,MAAOJ,CAAAA,IAAP,CACD,CACD,MAAO,KAAP,CACH,C,8CACUtB,K,CAAM,CACf;AACA,KAAKM,YAAL,CAAoBN,KAApB,CACA,GAAM2B,CAAAA,MAAM,CAAI3B,KAAK,CAACwB,cAAN,CAAqB,SAArB,GAAkCxB,KAAK,CAACyB,OAAN,CAAcC,OAAd,CAAsB,MAAtB,IAAgC,CAAC,CAAnF,CACA,OAAO1B,KAAK,CAACuB,MAAN,CAAaK,IAApB,EACA,IAAK,KAAL,CACE;AACA,KAAKC,gBAAL,GACA,KAAKvB,YAAL,CAAoB,KAAKwB,cAAL,CAAoB9B,KAAK,CAACkB,KAA1B,CAApB,CACA,MAAO,8BAAP,CACF,IAAK,MAAL,CACE;AACA,MAAO,MAAKa,UAAL,CAAgB/B,KAAhB,CAAP,CACF,IAAK,MAAL,CACE,MAAO2B,CAAAA,MAAM,sBAAe,KAAKK,IAAL,CAAUC,OAAV,CAAkBjC,KAAK,CAACkB,KAAN,CAAYC,IAA9B,CAAf,EAAqD,KAAKe,aAAL,CAAmBlC,KAAK,CAACkB,KAAN,CAAYC,IAA/B,CAAlE,CACF,IAAK,QAAL,CACE,KAAKgB,YAAL,GACA,MAAOnC,CAAAA,KAAK,CAACuB,MAAN,CAAaJ,IAAb,GAAoB,OAApB,CAA4B,oBAA5B,CAAiD,cAAxD,CACF,IAAK,SAAL,CACE;AACA,sBAAgBnB,KAAK,CAACkB,KAAN,CAAYC,IAA5B,EACF,QACE,MAAO,MAAKiB,oBAAL,CAA0BpC,KAA1B,CAAP,CAlBF,CAoBD,C,8CACUA,K,CAAM,CACf,GAAMqC,CAAAA,UAAU,CAAGrC,KAAK,CAACuB,MAAN,CAAaJ,IAAb,GAAoB,gBAApB,EAAsCnB,KAAK,CAACuB,MAAN,CAAaJ,IAAb,GAAoB,WAA7E,CACA,KAAKgB,YAAL,GACA,GAAGE,UAAH,CAAc,CACZ,KAAKtB,UAAL,CAAkBf,KAAK,CAACuB,MAAN,CAAaJ,IAA/B,CACA,GAAMI,CAAAA,MAAM,CAAGvB,KAAK,CAACuB,MAAN,CAAaJ,IAAb,GAAoB,WAApB,CAAgC,CAACS,IAAI,CAAC,QAAN,CAAgBT,IAAI,CAAC,OAArB,CAAhC,CAA8D,CAACS,IAAI,CAAC,MAAN,CAAcT,IAAI,CAAC,OAAnB,CAA7E,CACA,GAAMD,CAAAA,KAAK,CAAGlB,KAAK,CAACuB,MAAN,CAAaJ,IAAb,GAAoB,WAApB,CAAgC,CAACS,IAAI,CAAC,QAAN,CAAgBT,IAAI,CAAC,WAArB,CAAhC,CAAkE,CAACS,IAAI,CAAC,MAAN,CAAcT,IAAI,CAAC,gBAAnB,CAAhF,CACA,KAAKb,YAAL,CAAoB,CAACY,KAAK,CAACA,KAAP,CAAcK,MAAM,CAACA,MAArB,CAApB,CACA,MAAOvB,CAAAA,KAAK,CAACuB,MAAN,CAAaJ,IAAb,GAAoB,WAApB,CAAgC,mBAAhC,CAAoD,6BAA3D,CACD,CAND,IAMO,IAAG,KAAKa,IAAL,CAAUM,SAAV,CAAoBtC,KAAK,CAACuB,MAAN,CAAaJ,IAAjC,CAAH,CAA2C,CAChD;AACA,GAAMI,CAAAA,OAAM,CAAG,CAACK,IAAI,CAAC,MAAN,CAAcT,IAAI,CAACnB,KAAK,CAACuB,MAAN,CAAaJ,IAAhC,CAAf,CACA,GAAMD,CAAAA,MAAK,CAAG,CAACU,IAAI,CAAC,MAAN,CAAcT,IAAI,CAAC,OAAnB,CAAd,CACA,KAAKb,YAAL,CAAoB,CAACY,KAAK,CAACA,MAAP,CAAcK,MAAM,CAACA,OAArB,CAApB,CACA,qBAAevB,KAAK,CAACuB,MAAN,CAAaJ,IAA5B,EACD,CANM,IAMA,IAAGnB,KAAK,CAACuB,MAAN,CAAaJ,IAAb,GAAoB,OAAvB,CAA+B,CACpC,MAAO,iBAAP,CACD,CAFM,IAED,CACJ,GAAG,KAAKoB,kBAAL,CAAwBvC,KAAK,CAACuB,MAAN,CAAaJ,IAArC,CAAH,CAA8C,CAC5C,GAAMI,CAAAA,QAAM,CAAG,CAACK,IAAI,CAAC,MAAN,CAAcT,IAAI,CAAC,OAAnB,CAAf,CACA,GAAMD,CAAAA,OAAK,CAAG,CAACU,IAAI,CAAC,QAAN,CAAgBT,IAAI,CAAC,OAArB,CAAd,CACA,KAAKb,YAAL,CAAoB,CAACY,KAAK,CAACA,OAAP,CAAcK,MAAM,CAACA,QAArB,CAApB,CACA,4BAAsBvB,KAAK,CAACuB,MAAN,CAAaJ,IAAnC,EACD,CACD,MAAO,wBAAP,CACD,CACF,C,sDACcqB,I,CAAK,CAClB,GAAMC,CAAAA,GAAG,CAAG,CAACb,IAAI,CAAC,MAAN,CAAcT,IAAI,CAAC,KAAKa,IAAL,CAAUU,OAAV,CAAkB,CAAlB,CAAnB,CAAZ,CACA,KAAKC,YAAL,CAAoB,GAAI9C,CAAAA,KAAJ,CAAU,KAAK+C,MAAL,CAAY,CAAtB,CAApB,CACA,KAAKT,YAAL,GACA,MAAO,CAACjB,KAAK,CAACsB,IAAP,CAAajB,MAAM,CAACkB,GAApB,CAAP,CACD,C,oDACatB,I,CAAK,CACjB,GAAGA,IAAI,GAAG,EAAV,CAAa,CACX,KAAK0B,SAAL,CAAgB,GAAhB,CACD,CAFD,IAEO,CACL,KAAKA,SAAL,CAAgB1B,IAAhB,CACD,CACD,KAAKH,eAAL,CAAuB,CAAC8B,OAAO,CAAC,CAAClB,IAAI,CAAC,QAAN,CAAgBT,IAAI,CAAC,WAArB,CAAT,CAAvB,CACA,KAAKb,YAAL,CAAoB,KAAKwB,cAAL,CAAoB,CAACF,IAAI,CAAC,QAAN,CAAgBT,IAAI,CAAC,WAArB,CAApB,CAApB,CACD,C,2DACiB,CAChB,GAAG,KAAKwB,YAAL,GAAoB,IAAvB,CAA6B,MAAO,KAAP,CAC7B,GAAMI,CAAAA,KAAK,CAAG,KAAKJ,YAAnB,CACA,GAAMK,CAAAA,EAAE,CAAGD,KAAK,CAACE,OAAjB,CACA,GAAMC,CAAAA,CAAC,CAAG,KAAKC,MAAL,CAAYC,SAAZ,CAAsB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACJ,OAAF,GAAcD,EAAlB,EAAvB,CAAV,CACA,GAAGE,CAAC,GAAG,CAAC,CAAR,CAAU,CACR;AACA,KAAKC,MAAL,CAAYG,MAAZ,CAAmBJ,CAAnB,CAAqB,CAArB,CAAuBH,KAAvB,EACD,CAHD,IAIK,CACH,KAAKH,MAAL,CAAcG,KAAK,CAACE,OAApB,CACA,KAAKE,MAAL,CAAc,KAAKA,MAAL,CAAYI,MAAZ,CAAmBR,KAAnB,CAAd,CACD,CACF,C,sDACcnB,I,CAAK,CAClB,GAAG,KAAKe,YAAL,GAAoB,IAAvB,CAA6B,MAAO,KAAP,CAC7B,KAAKA,YAAL,CAAkBa,cAAlB,CAAiC5B,IAAjC,EACD,C,sEACsB6B,G,CAAI,CACzB,GAAG,KAAKd,YAAL,GAAoB,IAAvB,CAA6B,MAAO,KAAP,CAC7B,KAAKA,YAAL,CAAkBe,mBAAlB,CAAwCD,GAAxC,CACA,GAAMvC,CAAAA,KAAK,CAAG,CAACU,IAAI,CAAC,MAAN,CAAcT,IAAI,CAAC,gBAAnB,CAAd,CACA,GAAMI,CAAAA,MAAM,CAAG,CAACK,IAAI,CAAC,QAAN,CAAgBT,IAAI,CAAC,OAArB,CAAf,CACA,KAAKb,YAAL,CAAoB,CAACY,KAAK,CAACA,KAAP,CAAcK,MAAM,CAACA,MAArB,CAApB,CACA,KAAKpB,UAAL,CAAkB,KAAlB,CACD,C,0DACgBwD,M,CAAO,CACtB,GAAG,KAAKhB,YAAL,GAAoB,IAAvB,CAA6B,MAAO,KAAP,CAC7B,GAAMU,CAAAA,CAAC,CAAG,KAAKV,YAAf,CACA,GAAMiB,CAAAA,GAAG,CAAGP,CAAC,CAACQ,gBAAF,CAAmBF,MAAnB,CAAZ,CACA,KAAKhB,YAAL,CAAoBU,CAApB,CACA,MAAOO,CAAAA,GAAP,CACD,C,sDACchC,I,CAAK,CAClB,GAAG,KAAKe,YAAL,GAAoB,IAAvB,CAA6B,MAAO,KAAP,CAC7B,GAAMU,CAAAA,CAAC,CAAG,KAAKV,YAAf,CACA,GAAMiB,CAAAA,GAAG,CAAGP,CAAC,CAACjC,cAAF,CAAiBQ,IAAjB,CAAZ,CACA,KAAKe,YAAL,CAAoBU,CAApB,CACA,MAAOO,CAAAA,GAAP,CACD,C,8DACkBZ,E,CAAG,CACpB,GAAME,CAAAA,CAAC,CAAG,KAAKC,MAAL,CAAYC,SAAZ,CAAsB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACJ,OAAF,GAAcD,EAAlB,EAAvB,CAAV,CACA,GAAGE,CAAC,GAAG,CAAC,CAAR,CAAU,CACR,KAAKP,YAAL,CAAmB,KAAKQ,MAAL,CAAYD,CAAZ,CAAnB,CACA,MAAO,KAAP,CACD,CAHD,IAGO,CACL,MAAO,MAAP,CACD,CACF,C,gDACWF,E,CAAG,CACb,GAAME,CAAAA,CAAC,CAAG,KAAKC,MAAL,CAAYC,SAAZ,CAAsB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACJ,OAAF,GAAcD,EAAlB,EAAvB,CAAV,CACA,GAAGE,CAAC,GAAG,CAAC,CAAR,CAAU,CACR,KAAKC,MAAL,CAAYG,MAAZ,CAAmBJ,CAAnB,CAAqB,CAArB,EACA,KAAKY,QAAL,CAAgB,KAAKX,MAAL,CAAY9B,MAAZ,EAAhB,CACD,CACD,GAAG,KAAKsB,YAAL,GAAoB,IAApB,EAA0B,KAAKA,YAAL,CAAkBM,OAAlB,GAA4BD,EAAzD,CAA4D,CAC1D,KAAKe,WAAL,GACD,CACD,GAAMC,CAAAA,IAAI,CAAG,CAACpC,IAAI,CAAC,QAAN,CAAgBT,IAAI,CAAC,OAArB,CAAb,CACA,KAAKH,eAAL,CAAuB,CAAC8B,OAAO,CAACkB,IAAT,CAAexB,IAAI,CAACwB,IAApB,CAA0BC,IAAI,CAACD,IAA/B,CAAvB,CACD,C,gDACWhE,K,CAAM,CAChB,OAAOA,KAAK,CAAC4B,IAAb,EACE,IAAK,MAAL,CACE,MAAO,MAAKI,IAAL,CAAUkC,cAAV,CAAyBlE,KAAK,CAACmB,IAA/B,CAAP,CACF,IAAK,MAAL,CACE,MAAOnB,CAAAA,KAAK,CAACmB,IAAN,GAAa,OAAb,CAAqB,iCAArB,CAAuD,KAAKa,IAAL,CAAUkC,cAAV,CAAyBlE,KAAK,CAACmB,IAA/B,CAA9D,CACF,IAAK,QAAL,CACE,GAAMgD,CAAAA,GAAG,CAAG,wCAAZ,CACA,MAAOA,CAAAA,GAAG,CAACC,OAAJ,CAAY,KAAZ,CAAkBpE,KAAK,CAACmB,IAAN,GAAa,OAAb,CAAqB,mBAArB,CAAyC,mBAA3D,CAAP,CACF,IAAK,UAAL,CACE,MAAO,uDAAP,CACF,IAAK,QAAL,CACE,MAAO,0CAAP,CACF,IAAK,QAAL,CACE,MAAOnB,CAAAA,KAAK,CAACmB,IAAN,GAAa,SAAb,CAAuB,8CAAvB,CAAsE,0CAA7E,CACF,IAAK,QAAL,CACE,MAAO,uDAAP,CACF,QACE,MAAO,EAAP,CAjBJ,CAmBD,C,8CACUnB,K,CAAM,gBACf,GAAMiE,CAAAA,IAAI,CAAG,QAAPA,CAAAA,IAAO,CAACD,IAAD,CAAQ,CACnB,OAAOA,IAAI,CAACpC,IAAZ,EACE,IAAK,MAAL,CACE,GAAMyC,CAAAA,MAAM,CAAG,KAAI,CAACrC,IAAL,CAAUsC,OAAV,CAAkBN,IAAI,CAAC7C,IAAvB,CAAf,CACA,GAAM8C,CAAAA,KAAI,CAAGI,MAAM,GAAG,KAAT,CAAe,sBAAf,CAAsCA,MAAnD,CACA,GAAMzC,CAAAA,IAAI,CAAGyC,MAAM,GAAG,KAAT,CAAe,MAAf,CAAsBL,IAAI,CAACpC,IAAxC,CACA,MAAO,CAACA,IAAI,CAACA,IAAN,CAAYT,IAAI,CAAC8C,KAAjB,CAAP,CACF,IAAK,MAAL,CACE,GAAGD,IAAI,CAAC7C,IAAL,GAAY,MAAZ,EAAoB6C,IAAI,CAAC7C,IAAL,GAAY,MAAnC,CAA2C,MAAO,CAACS,IAAI,CAAC,QAAN,CAAgBT,IAAI,CAAC,OAArB,CAAP,CAC3C,GAAMA,CAAAA,IAAI,CAAG6C,IAAI,CAAC7C,IAAL,CAAUE,MAAV,CAAiB,CAAjB,CAAmB,OAAnB,CAA2B2C,IAAI,CAAC7C,IAA7C,CACA,MAAO,CAACS,IAAI,CAACoC,IAAI,CAACpC,IAAX,CAAiBT,IAAI,CAACA,IAAI,GAAG,OAAP,CAAe,KAAI,CAACa,IAAL,CAAUuC,SAAV,CAAoBhB,MAApB,CAA2B,CAAC,MAAD,CAA3B,CAAf,CAAoD,MAA1E,CAAP,CACF,IAAK,QAAL,CACE,MAAO,CAAC3B,IAAI,CAACoC,IAAI,CAACpC,IAAX,CAAiBT,IAAI,CAAC6C,IAAI,CAAC7C,IAAL,GAAY,OAAZ,CAAoB,KAAI,CAACgC,MAAL,CAAYqB,GAAZ,CAAgB,SAACnB,CAAD,CAAK,CAAC,MAAOA,CAAAA,CAAC,CAACJ,OAAT,CAAiB,CAAvC,CAApB,CAA6D,OAAnF,CAAP,CACF,QACE,MAAO,CAACrB,IAAI,CAAC,EAAN,CAAUT,IAAI,CAAC,EAAf,CAAP,CAbJ,CAeD,CAhBD,CAiBA,GAAMsD,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACT,IAAD,CAAQ,CAC3B,OAAOA,IAAI,CAACpC,IAAZ,EACE,IAAK,MAAL,CACA,IAAK,MAAL,CACE,GAAGoC,IAAI,CAACpC,IAAL,GAAY,MAAZ,EAAoBoC,IAAI,CAAC7C,IAAL,CAAUE,MAAV,CAAiB,CAAxC,CAA2C,MAAO,CAACO,IAAI,CAAC,QAAN,CAClD8C,QAAQ,CAAC,KAAI,CAACC,YAAL,CAAkB,KAAI,CAACC,cAAL,CAAoBZ,IAAI,CAAC7C,IAAzB,CAAlB,CADyC,CAAP,CACgB;AAC3D,GAAG6C,IAAI,CAAC7C,IAAL,GAAY,OAAf,CAAuB,CAAC,MAAO,EAAP,CAAU,CAClC,MAAO,CAACS,IAAI,CAAC,KAAI,CAACI,IAAL,CAAU6C,cAAV,CAAyBb,IAAI,CAAC7C,IAA9B,CAAN,CACLuD,QAAQ,CAAC,CAACI,QAAQ,CAAC,KAAI,CAAC9C,IAAL,CAAU+C,oBAAV,CAA+Bf,IAAI,CAAC7C,IAApC,CAAV,CACP6D,QAAQ,CAAC,KAAI,CAAChD,IAAL,CAAUiD,eAAV,CAA0BjB,IAAI,CAAC7C,IAA/B,CADF,CAEP+D,QAAQ,CAAC,KAAI,CAAC9D,cAAL,CAAoB4C,IAAI,CAAC7C,IAAzB,CAFF,CADJ,CAAP,CAIF,IAAK,QAAL,CACE,MAAO,CAACS,IAAI,CAAC,QAAN,CAAgB8C,QAAQ,CAAC,KAAI,CAACC,YAAL,CAAkBX,IAAI,CAAC7C,IAAvB,CAAzB,CAAP,CACF,QACE,MAAO,EAAP,CAbJ,CAeD,CAhBD,CAiBA,GAAMgE,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACnF,KAAD,CAAU,CAChC,OAAOA,KAAK,CAACkB,KAAN,CAAYU,IAAnB,EACE,IAAK,QAAL,CACE,MAAO5B,CAAAA,KAAK,CAACkB,KAAN,CAAYC,IAAZ,GAAmB,OAA1B,CACF,IAAK,MAAL,CACE,MAAOnB,CAAAA,KAAK,CAACoF,uBAAb,CACF,IAAK,MAAL,CACE,MAAO,MAAP,CACF,QACE,MAAO,MAAP,CARJ,CAUD,CAXD,CAYA,GAAMzD,CAAAA,MAAM,CAAI3B,KAAK,CAACwB,cAAN,CAAqB,SAArB,GAAkCxB,KAAK,CAACyB,OAAN,CAAcC,OAAd,CAAsB,MAAtB,IAAgC,CAAC,CAAnF,CACA,GAAM2D,CAAAA,OAAO,CAAG1D,MAAM,CAAC,KAAKK,IAAL,CAAUC,OAAV,CAAkBjC,KAAK,CAACuB,MAAN,CAAaJ,IAA/B,CAAD,CAAsCnB,KAAK,CAACkB,KAAN,CAAYC,IAAxE,CACA,GAAMmE,CAAAA,QAAQ,CAAGD,OAAO,GAAG,KAAV,CAAgB,YAAhB,CAA6BA,OAA9C,CACA,GAAME,CAAAA,QAAQ,CAAGF,OAAO,GAAG,KAAV,CAAgB,QAAhB,CAAyBrF,KAAK,CAACuB,MAAN,CAAaK,IAAvD,CACA,GAAG5B,KAAK,CAACkB,KAAN,CAAYU,IAAZ,GAAmB,SAAtB,CAAgC,CAC9B,GAAM4D,CAAAA,UAAU,CAAG,CACjB1C,OAAO,CAAC9C,KAAK,CAACuB,MADG,CAEjBiB,IAAI,CAAC,CAACZ,IAAI,CAAC2D,QAAN,CAAgBpE,IAAI,CAACmE,QAArB,CAFY,CAGjBrB,IAAI,CAACA,IAAI,CAACjE,KAAK,CAACuB,MAAP,CAHQ,CAIjB6D,uBAAuB,CAACD,eAAe,CAACnF,KAAD,CAJtB,CAKjByF,OAAO,CAAC,KAAKC,WAAL,CAAiB1F,KAAK,CAACuB,MAAvB,CALS,CAMjBkD,YAAY,CAACA,YAAY,CAACzE,KAAK,CAACuB,MAAP,CANR,CAAnB,CAQA,GAAGiE,UAAU,CAACvB,IAAX,CAAgBrC,IAAhB,GAAuB,MAAvB,EAA+B4D,UAAU,CAACvB,IAAX,CAAgBrC,IAAhB,GAAuB,QAAzD,CAAkE,CAAC,KAAKO,YAAL,GAAqB,CACxF,MAAOqD,CAAAA,UAAP,CACD,CAXD,IAWO,CACL;AACA,MAAQ,CACN1C,OAAO,CAAC9C,KAAK,CAACuB,MADR,CAENiB,IAAI,CAACxC,KAAK,CAACkB,KAFL,CAGNuE,OAAO,CAAC,EAHF,CAAR,CAKD,CACF,C,kDACY7D,I,CAAK,iBAChB,GAAGA,IAAI,GAAG,OAAV,CAAkB,CAChB,GAAM+D,CAAAA,OAAO,CAAE,KAAKxC,MAAL,CAAYqB,GAAZ,CAAgB,SAACnB,CAAD,CAAM,CAAC,MAAOA,CAAAA,CAAC,CAACuC,SAAT,CAAmB,CAA1C,CAAf,CACA,GAAMC,CAAAA,GAAG,CAAGF,OAAO,CAACtE,MAApB,CACA,MAAO,CACLF,IAAI,CAAC,KAAK0B,SADL,CAELgD,GAAG,CAACA,GAFC,CAGLC,MAAM,CAACH,OAAO,CAACnB,GAAR,CAAY,SAACtB,CAAD,CAAM,CAAC,MAAO,CAAA,MAAI,CAAC6C,kBAAL,CAAwB7C,CAAxB,CAAP,CAAkC,CAArD,CAHF,CAAP,CAKD,CARD,IAQO,CACL,GAAG8C,KAAK,CAACpE,IAAD,CAAR,CAAgB,MAAO,MAAKmE,kBAAL,CAAwB,KAAKpD,YAAL,CAAkBiD,SAA1C,CAAP,CAChB,GAAM1C,CAAAA,CAAC,CAAG,KAAKC,MAAL,CAAYC,SAAZ,CAAsB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACJ,OAAF,GAAcrB,IAAlB,EAAvB,CAAV,CACA,GAAGsB,CAAC,GAAG,CAAC,CAAR,CAAU,CAAC,yBAAmBtB,IAAnB,EAA2B,CACtC,GAAMmB,CAAAA,KAAK,CAAG,KAAKI,MAAL,CAAYD,CAAZ,CAAd,CACA,MAAO,MAAK6C,kBAAL,CAAwBhD,KAAK,CAAC6C,SAA9B,CAAP,CACD,CACF,C,8DACkB7C,K,CAAM,iBACvB,GAAMC,CAAAA,EAAE,CAAGD,KAAK,CAACC,EAAjB,CACA,GAAMiD,CAAAA,KAAK,CAAGlD,KAAK,CAACkD,KAApB,CACA,GAAMC,CAAAA,aAAa,CAAG,KAAKlE,IAAL,CAAUuC,SAAhC,CACA,GAAM4B,CAAAA,OAAO,CAAGpD,KAAK,CAACqD,QAAtB,CACA,GAAMC,CAAAA,WAAW,CAAGH,aAAa,CAAC1B,GAAd,CAAkB,SAACtB,CAAD,CAAM,CAC1C,GAAG,CAAC+C,KAAK,CAACzE,cAAN,CAAqB0B,CAArB,CAAJ,CAA4B,CAAC,MAAO,CAACoD,EAAE,CAACpD,CAAJ,CAAOqD,EAAE,cAAOrD,CAAP,UAAT,CAAP,CAAkC,CAC/D,GAAMsD,CAAAA,IAAI,CAAGP,KAAK,CAAC/C,CAAD,CAAlB,CACA,GAAMiB,CAAAA,GAAG,CAAG,MAAI,CAACsC,aAAL,CAAmBvD,CAAnB,CAAqBsD,IAArB,CAAZ,CACA,MAAQ,CACNF,EAAE,CAACpD,CADG,CAENqD,EAAE,CAACpC,GAFG,CAAR,CAID,CARmB,CAApB,CASA,MAAO,CACLnB,EAAE,CAAEA,EADC,CAEL0D,KAAK,CAACL,WAFD,CAGLM,QAAQ,CAACR,OAHJ,CAAP,CAKD,C,oDACavE,I,CAAKqE,K,CAAM,iBACvB,GAAMW,CAAAA,QAAQ,CAAGX,KAAK,CAACzB,GAAN,CAAU,SAACgC,IAAD,CAAQ,CACjC,GAAGA,IAAI,CAACxD,EAAL,GAAU,GAAV,EAAewD,IAAI,CAACxD,EAAL,GAAU,EAA5B,CAAgC,mBAAapB,IAAb,WAChC,GAAMiF,CAAAA,QAAQ,CAAG,MAAI,CAAC7E,IAAL,CAAU8E,WAAV,CAAsBlF,IAAtB,CAA2B4E,IAAI,CAACxD,EAAhC,CAAjB,CACA,GAAM+D,CAAAA,GAAG,CAAGP,IAAI,CAACO,GAAL,GAAW,GAAX,WAAkB,MAAI,CAAC/E,IAAL,CAAUgF,SAAV,CAAoB,KAApB,CAA0BR,IAAI,CAACO,GAA/B,CAAlB,MAAyD,EAArE,CACA,GAAME,CAAAA,IAAI,CAAGT,IAAI,CAACS,IAAL,GAAY,GAAZ,YAAoB,MAAI,CAACjF,IAAL,CAAUgF,SAAV,CAAoB,MAApB,CAA2BR,IAAI,CAACS,IAAhC,CAApB,EAA4D,EAAzE,CACA,gBAAUF,GAAV,SAAgBF,QAAhB,SAA2BI,IAA3B,EACD,CANgB,CAAjB,CAOA,MAAOL,CAAAA,QAAQ,CAACM,IAAT,CAAc,IAAd,CAAP,CACD,C,oDACatF,I,CAAK,CACjB,GAAG,KAAKe,YAAL,GAAoB,IAAvB,CAA6B,MAAO,KAAP,CAC7B,GAAMsD,CAAAA,KAAK,CAAG,GAAG1C,MAAH,CAAU,KAAKZ,YAAL,CAAkBwE,gBAAlB,CAAmCvF,IAAnC,CAAV,CAAd,CACA,GAAGqE,KAAK,CAAC5E,MAAN,GAAe,CAAf,EAAmB4E,KAAK,CAAC5E,MAAN,GAAe,CAAf,EAAkB4E,KAAK,CAAC,CAAD,CAAL,CAASjD,EAAT,GAAc,EAAtD,CAA0D,CACxD,mBAAapB,IAAb,WACD,CACD,MAAO,MAAK6E,aAAL,CAAmB7E,IAAnB,CAAwBqE,KAAxB,CAAP,CACD,C,kEAEoBjG,K,CAAM,CACzB,OAAOA,KAAK,CAACuB,MAAN,CAAaK,IAApB,EACE,IAAK,UAAL,CACE,KAAKb,UAAL,CAAkB,SAAlB,CACA,MAAO,gBAAP,CACF,IAAK,MAAL,CACE,GAAMyB,CAAAA,IAAI,CAACxC,KAAK,CAACkB,KAAjB,CACA,GAAM+C,CAAAA,IAAI,CAAG,CAACrC,IAAI,CAAC,QAAN,CAAgBT,IAAI,CAAC,OAArB,CAAb,CACA,GAAMsB,CAAAA,GAAG,CAAGzC,KAAK,CAACuB,MAAlB,CACA,KAAKP,eAAL,CAAuB,CAAC8B,OAAO,CAACL,GAAT,CAAcwB,IAAI,CAACA,IAAnB,CAAyBzB,IAAI,CAACA,IAA9B,CAAvB,CACA,KAAKzB,UAAL,CAAkBf,KAAK,CAACuB,MAAN,CAAaJ,IAA/B,CACA,KAAKhB,UAAL,CAAkB,IAAlB,CACA,MAAO,MAAK+B,aAAL,CAAmBlC,KAAK,CAACkB,KAAN,CAAYC,IAA/B,CAAP,CACF,IAAK,QAAL,CACE,MAAO,MAAKlB,MAAL,CAAYD,KAAK,CAACuB,MAAN,CAAaJ,IAAzB,CAAP,CACF,IAAK,QAAL,CACE,MAAO,MAAKiG,MAAL,CAAYpH,KAAK,CAACuB,MAAN,CAAaJ,IAAzB,CAAP,CACF,QACE,MAAO,kCAAP,CAjBJ,CAmBD,C,sCACMS,I,CAAK,CACV,OAAOA,IAAP,EACE,IAAK,SAAL,CACE,KAAKe,YAAL,CAAoB,IAApB,CACA,KAAKb,cAAL,CAAoB,CAACF,IAAI,CAAC,QAAN,CAAgBT,IAAI,CAAC,OAArB,CAApB,EACA,MAAO,uBAAP,CACF,IAAK,QAAL,CACE,GAAM6B,CAAAA,EAAE,CAAG,KAAKL,YAAL,CAAkBM,OAA7B,CACA,KAAKoE,WAAL,CAAiBrE,EAAjB,EACA,8BAAwBA,EAAxB,EACF,QACE,MAAO,oCAAP,CAVJ,CAYD,C,sCACMpB,I,CAAK,CACV,OAAQA,IAAR,EACA,IAAK,UAAL,CACE,MAAO,iBAAP,CACF,IAAK,aAAL,CACE,MAAO,4BAAP,CACF,IAAK,OAAL,CACE,KAAK1B,WAAL,CACE,CAAE2C,SAAS,CAAE,EAAb,CACEM,MAAM,CAAE,EADV,CAEEP,MAAM,CAAE,CAFV,CAGED,YAAY,CAAE,IAHhB,CAIEjC,cAAc,CAAE,CAJlB,CAKEM,eAAe,CAAE,IALnB,CAMEH,OAAO,CAAE,EANX,CAOEP,YAAY,CAAE,IAPhB,CAQES,UAAU,CAAE,cARd,CADF,EAYA,MAAO,mBAAP,CACF,QACE,MAAO,oCAAP,CApBF,CAsBD,C,gDACWf,K,CAAM,CAChB,KAAK6C,SAAL,CAAgB7C,KAAK,CAAC6C,SAAtB,CACA,KAAKM,MAAL,CAAanD,KAAK,CAACmD,MAAnB,CACA,KAAKP,MAAL,CAAc5C,KAAK,CAAC4C,MAApB,CACA,KAAKD,YAAL,CAAoB3C,KAAK,CAAC2C,YAA1B,CACA,KAAKjC,cAAL,CAAsBV,KAAK,CAACU,cAA5B,CACA,KAAKM,eAAL,CAAuBhB,KAAK,CAACgB,eAA7B,CACA,KAAKH,OAAL,CAAeb,KAAK,CAACa,OAArB,CACA,KAAKP,YAAL,CAAoBN,KAAK,CAACM,YAA1B,CACA,KAAK0B,IAAL,CAAY,GAAIlC,CAAAA,SAAJ,EAAZ,CACA,KAAKiB,UAAL,CAAkBf,KAAK,CAACe,UAAxB,CACD,C,mDACa,CACZ,KAAKA,UAAL,CAAgB,cAAhB,CACD,C,0BAKH,cAAehB,CAAAA,UAAf","sourcesContent":["import Pizza from './Pizza';\r\nimport PizzaMenu from './itemMenu';\r\n\r\nclass PizzaOrder {\r\n  constructor(props) {\r\n    if(props==='new'){\r\n      this.Cancel('order');\r\n    } else {\r\n      this.CreateOrder(props);\r\n    }\r\n    this.getSpecial=false;                \r\n  }\r\n  ProcessStep(props){\r\n    const stepKey = props.key;\r\n    const triggerValue = props.trigger;\r\n    const userMsg = this.getUserMsg(triggerValue);    \r\n    this.stepsProcessed++;\r\n    const bot = `Step-${this.stepsProcessed}: ${stepKey.substring(0,5)}`;\r\n    this.botKeys.push(bot)\r\n    return {userMsg:userMsg, trigger:this.newTrigger, key:bot};\r\n  }\r\n  GetDisplayStep(){\r\n    if(this.currentStepInfo===null||this.triggerValue===null) return null\r\n    this.currentStepInfo = this.CreateStep(this.triggerValue);\r\n    return this.currentStepInfo;\r\n  }\r\n  CurrentStepSelection(props){   \r\n    if((props.owner.name==='crusts'||props.owner.name==='sizes')&&this.SelectionArray(props.owner.name).length===0){\r\n        const trig = (props.target.name==='remove'||props.target.name==='cancel'||(props.hasOwnProperty('btnCapt')&&(props.btnCapt.indexOf('Prev')!==-1)))?true:false;      \r\n        return trig;\r\n      }\r\n      return true;    \r\n  }\r\n  getUserMsg(props){\r\n    //returns the user message to the custom step\r\n    this.triggerValue = props;\r\n    const isPrev = (props.hasOwnProperty('btnCapt')&&(props.btnCapt.indexOf('Prev')!==-1));\r\n    switch(props.target.type){\r\n    case 'new':\r\n      //add new pizza\r\n      this.SavePizzaToOrder();\r\n      this.triggerValue = this.CreateNewPizza(props.owner);             \r\n      return 'Add a new pizza to the order';     \r\n    case 'edit':\r\n      //handle edits\r\n      return this.HandelEdit(props);      \r\n    case 'menu':\r\n      return isPrev?`Go back to ${this.menu.getPrev(props.owner.name)}`:this.CreateItemMsg(props.owner.name);\r\n    case 'review':\r\n      this.ResetTrigger();           \r\n      return props.target.name==='order'?'Review pizza order':'Review pizza';          \r\n    case 'special': \r\n      //Going to a special step\r\n      return `Go to ${props.owner.name}`;      \r\n    default:\r\n      return this.HandleSpecialActions(props);\r\n    }\r\n  }\r\n  HandelEdit(props){\r\n    const altTrigger = props.target.name==='specialinstmsg'||props.target.name==='ordername';        \r\n    this.ResetTrigger();\r\n    if(altTrigger){\r\n      this.newTrigger = props.target.name;      \r\n      const target = props.target.name==='ordername'?{type:'review', name:'order'}:{type:'edit', name:'pizza'};\r\n      const owner = props.target.name==='ordername'?{type:'change', name:'ordername'}:{type:'inst', name:'specialinstmsg'};\r\n      this.triggerValue = {owner:owner, target:target};\r\n      return props.target.name==='ordername'?'Change order name':'Change special instructions';\r\n    } else if(this.menu.checkStep(props.target.name)) {\r\n      //menu step\r\n      const target = {type:'edit', name:props.target.name};\r\n      const owner = {type:'edit', name:'pizza'};\r\n      this.triggerValue = {owner:owner, target:target};\r\n      return `Edit ${props.target.name}`;\r\n    } else if(props.target.name==='pizza'){\r\n      return 'Edit this pizza'\r\n    }else {\r\n      if(this.ChangeCurrentPizza(props.target.name)){        \r\n        const target = {type:'edit', name:'pizza'};\r\n        const owner = {type:'review', name:'order'};\r\n        this.triggerValue = {owner:owner, target:target};\r\n        return `Edit Pizza #${props.target.name}`;\r\n      }\r\n      return 'Invalid edit selection'\r\n    }    \r\n  }\r\n  CreateNewPizza(prev){\r\n    const cur = {type:'menu', name:this.menu.getStep(0)};\r\n    this.currentPizza = new Pizza(this.lastID+1);\r\n    this.ResetTrigger();    \r\n    return {owner:prev, target:cur}           \r\n  }\r\n  StartNewOrder(name){    \r\n    if(name===''){\r\n      this.orderName= ' ';\r\n    } else {\r\n      this.orderName= name;\r\n    }\r\n    this.currentStepInfo = {current:{type:'change', name:'ordername'}};\r\n    this.triggerValue = this.CreateNewPizza({type:'change', name:'ordername'})\r\n  } \r\n  SavePizzaToOrder(){    \r\n    if(this.currentPizza===null) return null;\r\n    const pizza = this.currentPizza;    \r\n    const id = pizza.PizzaID;\r\n    const i = this.pizzas.findIndex(p => p.PizzaID === id);\r\n    if(i!==-1){\r\n      //Override existing pizza\r\n      this.pizzas.splice(i,1,pizza);\r\n    }\r\n    else {\r\n      this.lastID = pizza.PizzaID;\r\n      this.pizzas = this.pizzas.concat(pizza);\r\n    }\r\n  }\r\n  EditSelections(type){\r\n    if(this.currentPizza===null) return null;    \r\n    this.currentPizza.EditSelections(type);    \r\n  } \r\n  AddSpecialInstructions(val){\r\n    if(this.currentPizza===null) return null;    \r\n    this.currentPizza.SpecialInstructions = val;    \r\n    const owner = {type:'inst', name:'specialinstmsg'};\r\n    const target = {type:'review', name:'pizza'};\r\n    this.triggerValue = {owner:owner, target:target};\r\n    this.getSpecial = false;\r\n  }\r\n  SelectPizzaItems(values){\r\n    if(this.currentPizza===null) return null;\r\n    const p = this.currentPizza;\r\n    const ret = p.SelectPizzaItems(values);\r\n    this.currentPizza = p;\r\n    return ret;    \r\n  }\r\n  SelectionArray(type){\r\n    if(this.currentPizza===null) return null;\r\n    const p = this.currentPizza;\r\n    const ret = p.SelectionArray(type);\r\n    this.currentPizza = p;\r\n    return ret;    \r\n  }\r\n  ChangeCurrentPizza(id){\r\n    const i = this.pizzas.findIndex(p => p.PizzaID === id);\r\n    if(i!==-1){\r\n      this.currentPizza =this.pizzas[i];\r\n      return true\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n  RemovePizza(id){    \r\n    const i = this.pizzas.findIndex(p => p.PizzaID === id);\r\n    if(i!==-1){\r\n      this.pizzas.splice(i,1);\r\n      this.pizzaCnt = this.pizzas.length();\r\n    }\r\n    if(this.currentPizza!==null&&this.currentPizza.PizzaID===id){\r\n      this.CancelPizza();\r\n    }\r\n    const step = {type:'review', name:'order'};\r\n    this.currentStepInfo =({current:step, prev:step, next:step})\r\n  }\r\n  StepMessage(props){    \r\n    switch(props.type){\r\n      case 'menu':\r\n        return this.menu.getStepMessage(props.name);         \r\n      case 'edit':         \r\n        return props.name==='pizza'?'Please select an option to edit':this.menu.getStepMessage(props.name);         \r\n      case 'review':\r\n        const str = 'Please {0} and select an option below:'\r\n        return str.replace('{0}',props.name==='order'?'review your order':'review this pizza');\r\n      case 'complete':\r\n        return 'Complete this order and go to payment & confirmation?'\r\n      case 'cancel':\r\n        return 'Do you really want to cancel this order?';\r\n      case 'remove':\r\n        return props.name==='restart'?'Are you sure you want to discard this pizza?':'Do you really want to remove this pizza?';\r\n      case 'change':\r\n        return 'Do you really want to change the name for this order?'\r\n      default:\r\n        return '';\r\n    }\r\n  }  \r\n  CreateStep(props){       \r\n    const next = (step)=>{\r\n      switch(step.type){\r\n        case 'menu':         \r\n          const chkNxt = this.menu.getNext(step.name);\r\n          const next = chkNxt==='EOM'?'Special Instructions':chkNxt;\r\n          const type = chkNxt==='EOM'?'inst':step.type;   \r\n          return {type:type, name:next};         \r\n        case 'edit':          \r\n          if(step.name==='save'||step.name==='drop') return {type:'review', name:'pizza'}\r\n          const name = step.name.length<3?'pizza':step.name;\r\n          return {type:step.type, name:name==='pizza'?this.menu.MenuSteps.concat(['inst']):'item'};         \r\n        case 'review':\r\n          return {type:step.type, name:step.name==='order'?this.pizzas.map((p)=>{return p.PizzaID}):'pizza'};\r\n        default:\r\n          return {type:'', name:''};\r\n      }\r\n    }\r\n    const stepContents = (step)=>{\r\n      switch(step.type){\r\n        case 'menu':\r\n        case 'edit':         \r\n          if(step.type==='edit'&&step.name.length<3) return {type:'review', \r\n          contents:this.CreateReview(this.GetPizzaString(step.name))}//pizza summary\r\n          if(step.name==='pizza'){return ''}\r\n          return {type:this.menu.getContentType(step.name), \r\n            contents:{hasMulti:this.menu.getHasMultipleSelect(step.name),\r\n              elements:this.menu.getStepElements(step.name),              \r\n              selected:this.SelectionArray(step.name),}}        \r\n        case 'review':         \r\n          return {type:'review', contents:this.CreateReview(step.name)}\r\n        default:          \r\n          return ''\r\n      }\r\n    };\r\n    const fromReviewOrder = (props)=> {\r\n      switch(props.owner.type){\r\n        case 'review':\r\n          return props.owner.name==='order';\r\n        case 'edit':\r\n          return props.isReturnFromReviewOrder;\r\n        case 'menu':\r\n          return false;\r\n        default:\r\n          return false;\r\n      }\r\n    }\r\n    const isPrev = (props.hasOwnProperty('btnCapt')&&(props.btnCapt.indexOf('Prev')!==-1));\r\n    const chkPrev = isPrev?this.menu.getPrev(props.target.name):props.owner.name;\r\n    const prevStep = chkPrev==='BOM'?'Enter Name':chkPrev\r\n    const prevType  =chkPrev==='BOM'?'change':props.target.type;\r\n    if(props.owner.type!=='special'){      \r\n      const returnStep = {\r\n        current:props.target, \r\n        prev:{type:prevType, name:prevStep}, \r\n        next:next(props.target),\r\n        isReturnFromReviewOrder:fromReviewOrder(props),\r\n        stepMsg:this.StepMessage(props.target), \r\n        stepContents:stepContents(props.target)\r\n      };\r\n      if(returnStep.next.type!=='inst'||returnStep.next.type!=='change'){this.ResetTrigger();}    \r\n      return returnStep;\r\n    } else {\r\n      //handle special step\r\n      return ({\r\n        current:props.target, \r\n        prev:props.owner,\r\n        stepMsg:'',\r\n      })\r\n    }    \r\n  }\r\n  CreateReview(type){    \r\n    if(type==='order'){\r\n      const infoMap= this.pizzas.map((p)=> {return p.PizzaInfo});\r\n      const cnt = infoMap.length;      \r\n      return({\r\n        name:this.orderName,\r\n        cnt:cnt,\r\n        tables:infoMap.map((i)=> {return this.CreateSummaryTable(i)})\r\n      })\r\n    } else {\r\n      if(isNaN(type)) return this.CreateSummaryTable(this.currentPizza.PizzaInfo);\r\n      const i = this.pizzas.findIndex(p => p.PizzaID === type);\r\n      if(i===-1){return `No pizza ${type}`;}\r\n      const pizza = this.pizzas[i];     \r\n      return this.CreateSummaryTable(pizza.PizzaInfo)\r\n    }\r\n  }\r\n  CreateSummaryTable(pizza){\r\n    const id = pizza.id;\r\n    const items = pizza.items;\r\n    const itemTypeArray = this.menu.MenuSteps;\r\n    const spcinst = pizza.specinst;\r\n    const stringArray = itemTypeArray.map((i)=> {\r\n      if(!items.hasOwnProperty(i)){return {tr:i, td:`No ${i} added`}}\r\n      const item = items[i];     \r\n      const str = this.getItemString(i,item);\r\n      return ({\r\n        tr:i,\r\n        td:str,\r\n      })\r\n    })\r\n    return({\r\n      id: id,\r\n      table:stringArray,\r\n      specInst:spcinst,\r\n    })\r\n  }\r\n  getItemString(type,items){    \r\n    const retArray = items.map((item)=>{      \r\n      if(item.id==='0'||item.id==='') return `No ${type} added`;\r\n      const itemName = this.menu.GetItemName(type,item.id);\r\n      const qty = item.qty!=='0'?`${this.menu.GetOptMsg('qty',item.qty)} `:'';\r\n      const half = item.half!=='0'?` ${this.menu.GetOptMsg('half',item.half)}`:'';\r\n      return `${qty}${itemName}${half}`;\r\n    })\r\n    return retArray.join(', ')\r\n  }\r\n  CreateItemMsg(type){\r\n    if(this.currentPizza===null) return null;    \r\n    const items = [].concat(this.currentPizza.getSelectedItems(type));\r\n    if(items.length===0||(items.length===1&&items[0].id==='')){\r\n      return `No ${type} added`;\r\n    }    \r\n    return this.getItemString(type,items);\r\n  }\r\n  \r\n  HandleSpecialActions(props){\r\n    switch(props.target.type){\r\n      case 'complete':\r\n        this.newTrigger = 'endmsg1';      \r\n        return 'Complete Order'       \r\n      case 'inst':\r\n        const prev=props.owner;\r\n        const next = {type:'review', name:'pizza'};\r\n        const cur = props.target;\r\n        this.currentStepInfo =({current:cur, next:next, prev:prev});\r\n        this.newTrigger = props.target.name;\r\n        this.getSpecial = true;\r\n        return this.CreateItemMsg(props.owner.name);        \r\n      case 'cancel':\r\n        return this.Cancel(props.target.name);\r\n      case 'remove':\r\n        return this.Remove(props.target.name);\r\n      default:\r\n        return 'Invalid special action attempted'\r\n    }    \r\n  }  \r\n  Remove(type){    \r\n    switch(type){\r\n      case 'restart':\r\n        this.currentPizza = null;\r\n        this.CreateNewPizza({type:'review', name:'order'})\r\n        return 'Start this pizza over'\r\n      case 'remove':\r\n        const id = this.currentPizza.PizzaID;            \r\n        this.RemovePizza(id);\r\n        return `Remove pizza #${id}`;\r\n      default:\r\n        return 'Invalid remove operation attempted'\r\n    }\r\n  }\r\n  Cancel(type){\r\n    switch (type){      \r\n    case 'mainpage':            \r\n      return 'Go to main page';          \r\n    case 'storeselect':\r\n      return 'Go to store selection page'\r\n    case 'order':\r\n      this.CreateOrder(\r\n        { orderName: '',\r\n          pizzas: [],    \r\n          lastID: 0,\r\n          currentPizza: null,\r\n          stepsProcessed: 0,   \r\n          currentStepInfo: null,\r\n          botKeys: [],\r\n          triggerValue: null,      \r\n          newTrigger: 'pizzabuilder',\r\n        }\r\n      )\r\n      return 'Cancel this order'\r\n    default:\r\n      return 'Invalid cancel operation attempted'\r\n    }\r\n  }\r\n  CreateOrder(props){\r\n    this.orderName= props.orderName;\r\n    this.pizzas= props.pizzas;    \r\n    this.lastID = props.lastID;\r\n    this.currentPizza = props.currentPizza;\r\n    this.stepsProcessed = props.stepsProcessed;   \r\n    this.currentStepInfo = props.currentStepInfo;\r\n    this.botKeys = props.botKeys;\r\n    this.triggerValue = props.triggerValue;\r\n    this.menu = new PizzaMenu();\r\n    this.newTrigger = props.newTrigger;\r\n  }\r\n  ResetTrigger(){\r\n    this.newTrigger='pizzabuilder';\r\n  }\r\n}\r\n    \r\n\r\n\r\nexport default PizzaOrder;\r\n"]},"metadata":{},"sourceType":"module"}