{"ast":null,"code":"import _objectSpread from\"C:/Users/TheTOP/Documents/GitHub/pizza-chatbot-chk4/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"C:/Users/TheTOP/Documents/GitHub/pizza-chatbot-chk4/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/TheTOP/Documents/GitHub/pizza-chatbot-chk4/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/TheTOP/Documents/GitHub/pizza-chatbot-chk4/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/TheTOP/Documents/GitHub/pizza-chatbot-chk4/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{Component}from'react';import Random from'random-id';import{CustomStep,OptionsStep,TextStep}from'./steps_components';import schema from'./schemas/schema';import*as storage from'./storage';import{ChatBotContainer,Content,Header,HeaderTitle,HeaderIcon,FloatButton,FloatingIcon,Footer,Input,SubmitButton}from'./components';import Recognition from'./recognition';import{ChatIcon,CloseIcon,SubmitIcon,MicIcon}from'./icons';import{isMobile}from'./utils';import{speakFn}from'./speechSynthesis';var ChatBot=/*#__PURE__*/function(_Component){_inherits(ChatBot,_Component);var _super=_createSuper(ChatBot);/* istanbul ignore next */function ChatBot(props){var _this;_classCallCheck(this,ChatBot);_this=_super.call(this,props);_this.onNodeInserted=function(event){var target=event.currentTarget;var enableSmoothScroll=_this.props.enableSmoothScroll;if(enableSmoothScroll&&_this.supportsScrollBehavior){target.scroll({top:target.scrollHeight,left:0,behavior:'smooth'});}else{target.scrollTop=target.scrollHeight;}};_this.onResize=function(){_this.content.scrollTop=_this.content.scrollHeight;};_this.onRecognitionChange=function(value){_this.setState({inputValue:value});};_this.onRecognitionEnd=function(){_this.setState({speaking:false});_this.handleSubmitButton();};_this.onRecognitionStop=function(){_this.setState({speaking:false});};_this.onValueChange=function(event){_this.setState({inputValue:event.target.value});};_this.getTriggeredStep=function(trigger,value){var steps=_this.generateRenderedStepsById();return typeof trigger==='function'?trigger({value:value,steps:steps}):trigger;};_this.getStepMessage=function(message){var previousSteps=_this.state.previousSteps;var lastStepIndex=previousSteps.length>0?previousSteps.length-1:0;var steps=_this.generateRenderedStepsById();var previousValue=previousSteps[lastStepIndex].value;return typeof message==='function'?message({previousValue:previousValue,steps:steps}):message;};_this.generateRenderedStepsById=function(){var previousSteps=_this.state.previousSteps;var steps={};for(var i=0,len=previousSteps.length;i<len;i+=1){var _previousSteps$i=previousSteps[i],id=_previousSteps$i.id,message=_previousSteps$i.message,value=_previousSteps$i.value,metadata=_previousSteps$i.metadata;steps[id]={id:id,message:message,value:value,metadata:metadata};}return steps;};_this.triggerNextStep=function(data){var enableMobileAutoFocus=_this.props.enableMobileAutoFocus;var _this$state=_this.state,defaultUserSettings=_this$state.defaultUserSettings,previousSteps=_this$state.previousSteps,renderedSteps=_this$state.renderedSteps,steps=_this$state.steps;var _this$state2=_this.state,currentStep=_this$state2.currentStep,previousStep=_this$state2.previousStep;var isEnd=currentStep.end;if(data&&data.value){currentStep.value=data.value;}if(data&&data.hideInput){currentStep.hideInput=data.hideInput;}if(data&&data.hideExtraControl){currentStep.hideExtraControl=data.hideExtraControl;}if(data&&data.trigger){currentStep.trigger=_this.getTriggeredStep(data.trigger,data.value);}if(isEnd){_this.handleEnd();}else if(currentStep.options&&data){var option=currentStep.options.filter(function(o){return o.value===data.value;})[0];var trigger=_this.getTriggeredStep(option.trigger,currentStep.value);delete currentStep.options;// replace choose option for user message\ncurrentStep=Object.assign({},currentStep,option,defaultUserSettings,{user:true,message:option.label,trigger:trigger});renderedSteps.pop();previousSteps.pop();renderedSteps.push(currentStep);previousSteps.push(currentStep);_this.setState({currentStep:currentStep,renderedSteps:renderedSteps,previousSteps:previousSteps});}else if(currentStep.trigger&&currentStep.replace&&data){var _trigger=_this.getTriggeredStep(currentStep.trigger,currentStep.value);var val=currentStep.value;var msg=data.userMsg;//user message\nvar stepMsg=data.botStepMsg;//bot message\nvar hasUserMessage=data.preserveMsg;var isSpecialStep=data.hasOwnProperty('isSpecialStep')?data.isSpecialStep:false;var defaultBotSettings={delay:0,avatar:_this.props.botAvatar,botName:_this.props.botName};//delete currentStep.component;  \nif(hasUserMessage){var thisStepMsg={id:currentStep.id,key:currentStep.key,msg:stepMsg,trigger:''};var nextS=Object.assign({},thisStepMsg,0,defaultBotSettings,{user:false,message:stepMsg,rendered:true});delete currentStep.component;delete currentStep.trigger;currentStep=Object.assign({},currentStep,val,defaultUserSettings,{user:true,message:msg,trigger:_trigger});renderedSteps.pop();previousSteps.pop();renderedSteps.push(nextS);previousSteps.push(nextS);renderedSteps.push(currentStep);previousSteps.push(currentStep);_this.setState({currentStep:currentStep,renderedSteps:renderedSteps,previousSteps:previousSteps});}/* else if(isSpecialStep){\r\n          delete currentStep.component;              \r\n          const previousStep = this.state.previousStep;\r\n          const out = hasUserMessage?msg:stepMsg;\r\n          \r\n          const thisStepMsg = {id:previousStep.id, key: previousStep.key, msg: previousStep.value, trigger: \"\"};\r\n          const nextS = Object.assign({}, thisStepMsg, 0, defaultUserSettings, {\r\n            user: true,\r\n            message: previousStep.value,\r\n            rendered:isSpecialStep,           \r\n            \r\n          });\r\n\r\n          currentStep = Object.assign({}, currentStep, val, defaultBotSettings, {\r\n            user: hasUserMessage,\r\n            message: out,\r\n            rendered:false,\r\n            \r\n          });\r\n          renderedSteps.pop();\r\n          previousSteps.pop();\r\n          renderedSteps.pop();\r\n          previousSteps.pop();\r\n          renderedSteps.push(nextS);\r\n          previousSteps.push(nextS);\r\n          renderedSteps.push(currentStep);\r\n          previousSteps.push(currentStep);\r\n          \r\n          this.setState({\r\n            currentStep,\r\n            renderedSteps,\r\n            previousSteps\r\n          });\r\n        \r\n        } */else{delete currentStep.component;var settings=hasUserMessage?defaultUserSettings:defaultBotSettings;var out=hasUserMessage?msg:stepMsg;currentStep=Object.assign({},currentStep,val,settings,{user:hasUserMessage,message:out,trigger:_trigger});renderedSteps.pop();previousSteps.pop();renderedSteps.push(currentStep);previousSteps.push(currentStep);_this.setState({currentStep:currentStep,renderedSteps:renderedSteps,previousSteps:previousSteps});}}else if(currentStep.trigger){var _trigger2=_this.getTriggeredStep(currentStep.trigger,currentStep.value);var nextStep=Object.assign({},steps[_trigger2]);if(nextStep.message){nextStep.message=_this.getStepMessage(nextStep.message);}else if(nextStep.update){var updateStep=nextStep;nextStep=Object.assign({},steps[updateStep.update]);if(nextStep.options){for(var i=0,len=nextStep.options.length;i<len;i+=1){nextStep.options[i].trigger=updateStep.trigger;}}else{nextStep.trigger=updateStep.trigger;}}nextStep.key=Random(24);previousStep=currentStep;currentStep=nextStep;_this.setState({renderedSteps:renderedSteps,currentStep:currentStep,previousStep:previousStep},function(){if(nextStep.user){_this.setState({disabled:false},function(){if(enableMobileAutoFocus||!isMobile()){if(_this.input){_this.input.focus();}}});}else{renderedSteps.push(nextStep);previousSteps.push(nextStep);_this.setState({renderedSteps:renderedSteps,previousSteps:previousSteps});}});}var _this$props=_this.props,cache=_this$props.cache,cacheName=_this$props.cacheName;if(cache){setTimeout(function(){storage.setData(cacheName,{currentStep:currentStep,previousStep:previousStep,previousSteps:previousSteps,renderedSteps:renderedSteps});},300);}};_this.handleEnd=function(){var handleEnd=_this.props.handleEnd;if(handleEnd){var previousSteps=_this.state.previousSteps;var renderedSteps=previousSteps.map(function(step){var id=step.id,message=step.message,value=step.value,metadata=step.metadata;return{id:id,message:message,value:value,metadata:metadata};});var steps=[];for(var i=0,len=previousSteps.length;i<len;i+=1){var _previousSteps$i2=previousSteps[i],id=_previousSteps$i2.id,message=_previousSteps$i2.message,value=_previousSteps$i2.value,metadata=_previousSteps$i2.metadata;steps[id]={id:id,message:message,value:value,metadata:metadata};}var values=previousSteps.filter(function(step){return step.value;}).map(function(step){return step.value;});handleEnd({renderedSteps:renderedSteps,steps:steps,values:values});}};_this.isInputValueEmpty=function(){var inputValue=_this.state.inputValue;return!inputValue||inputValue.length===0;};_this.isLastPosition=function(step){var renderedSteps=_this.state.renderedSteps;var length=renderedSteps.length;var stepIndex=renderedSteps.map(function(s){return s.key;}).indexOf(step.key);if(length<=1||stepIndex+1===length){return true;}var nextStep=renderedSteps[stepIndex+1];var hasMessage=nextStep.message||nextStep.asMessage;if(!hasMessage){return true;}var isLast=step.user!==nextStep.user;return isLast;};_this.isFirstPosition=function(step){var renderedSteps=_this.state.renderedSteps;var stepIndex=renderedSteps.map(function(s){return s.key;}).indexOf(step.key);if(stepIndex===0){return true;}var lastStep=renderedSteps[stepIndex-1];var hasMessage=lastStep.message||lastStep.asMessage;if(!hasMessage){return true;}var isFirst=step.user!==lastStep.user;return isFirst;};_this.handleKeyPress=function(event){if(event.key==='Enter'){_this.submitUserMessage();}};_this.handleSubmitButton=function(){var _this$state3=_this.state,speaking=_this$state3.speaking,recognitionEnable=_this$state3.recognitionEnable;if((_this.isInputValueEmpty()||speaking)&&recognitionEnable){_this.recognition.speak();if(!speaking){_this.setState({speaking:true});}return;}_this.submitUserMessage();};_this.submitUserMessage=function(){var _this$state4=_this.state,defaultUserSettings=_this$state4.defaultUserSettings,inputValue=_this$state4.inputValue,previousSteps=_this$state4.previousSteps,renderedSteps=_this$state4.renderedSteps;var currentStep=_this.state.currentStep;var isInvalid=currentStep.validator&&_this.checkInvalidInput();if(!isInvalid){var step={message:inputValue,value:inputValue};currentStep=Object.assign({},defaultUserSettings,currentStep,step);renderedSteps.push(currentStep);previousSteps.push(currentStep);_this.setState({currentStep:currentStep,renderedSteps:renderedSteps,previousSteps:previousSteps,disabled:true,inputValue:''},function(){if(_this.input){_this.input.blur();}});}};_this.checkInvalidInput=function(){var enableMobileAutoFocus=_this.props.enableMobileAutoFocus;var _this$state5=_this.state,currentStep=_this$state5.currentStep,inputValue=_this$state5.inputValue;var result=currentStep.validator(inputValue);var value=inputValue;if(typeof result!=='boolean'||!result){_this.setState({inputValue:result.toString(),inputInvalid:true,disabled:true},function(){setTimeout(function(){_this.setState({inputValue:value,inputInvalid:false,disabled:false},function(){if(enableMobileAutoFocus||!isMobile()){if(_this.input){_this.input.focus();}}});},2000);});return true;}return false;};_this.toggleChatBot=function(opened){var toggleFloating=_this.props.toggleFloating;if(toggleFloating){toggleFloating({opened:opened});}else{_this.setState({opened:opened});}};_this.renderStep=function(step,index){var renderedSteps=_this.state.renderedSteps;var _this$props2=_this.props,avatarStyle=_this$props2.avatarStyle,bubbleStyle=_this$props2.bubbleStyle,bubbleOptionStyle=_this$props2.bubbleOptionStyle,customStyle=_this$props2.customStyle,hideBotAvatar=_this$props2.hideBotAvatar,hideUserAvatar=_this$props2.hideUserAvatar,speechSynthesis=_this$props2.speechSynthesis;var options=step.options,component=step.component,asMessage=step.asMessage;var steps=_this.generateRenderedStepsById();var previousStep=index>0?renderedSteps[index-1]:{};if(component&&!asMessage){return/*#__PURE__*/_jsx(CustomStep,{speak:_this.speak,step:step,steps:steps,style:customStyle,previousStep:previousStep,previousValue:previousStep.value,triggerNextStep:_this.triggerNextStep},index);}if(options){return/*#__PURE__*/_jsx(OptionsStep,{step:step,previousValue:previousStep.value,triggerNextStep:_this.triggerNextStep,bubbleOptionStyle:bubbleOptionStyle},index);}return/*#__PURE__*/_jsx(TextStep,{step:step,steps:steps,speak:_this.speak,previousStep:previousStep,previousValue:previousStep.value,triggerNextStep:_this.triggerNextStep,avatarStyle:avatarStyle,bubbleStyle:bubbleStyle,hideBotAvatar:hideBotAvatar,hideUserAvatar:hideUserAvatar,speechSynthesis:speechSynthesis,isFirst:_this.isFirstPosition(step),isLast:_this.isLastPosition(step)},index);};_this.content=null;_this.input=null;_this.supportsScrollBehavior=false;_this.setContentRef=function(element){_this.content=element;};_this.setInputRef=function(element){_this.input=element;};_this.state={renderedSteps:[],previousSteps:[],currentStep:{},previousStep:{},steps:{},disabled:true,opened:props.opened||!props.floating,inputValue:'',inputInvalid:false,speaking:false,recognitionEnable:props.recognitionEnable&&Recognition.isSupported(),defaultUserSettings:{}};_this.speak=speakFn(props.speechSynthesis);return _this;}_createClass(ChatBot,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;var steps=this.props.steps;var _this$props3=this.props,botDelay=_this$props3.botDelay,botAvatar=_this$props3.botAvatar,botName=_this$props3.botName,cache=_this$props3.cache,cacheName=_this$props3.cacheName,customDelay=_this$props3.customDelay,enableMobileAutoFocus=_this$props3.enableMobileAutoFocus,userAvatar=_this$props3.userAvatar,userDelay=_this$props3.userDelay;var chatSteps={};var defaultBotSettings={delay:botDelay,avatar:botAvatar,botName:botName};var defaultUserSettings={delay:userDelay,avatar:userAvatar,hideInput:false,hideExtraControl:false};var defaultCustomSettings={delay:customDelay};for(var i=0,len=steps.length;i<len;i+=1){var step=steps[i];var settings={};if(step.user){settings=defaultUserSettings;}else if(step.message||step.asMessage){settings=defaultBotSettings;}else if(step.component){settings=defaultCustomSettings;}chatSteps[step.id]=Object.assign({},settings,schema.parse(step));}schema.checkInvalidIds(chatSteps);var firstStep=steps[0];if(firstStep.message){var message=firstStep.message;firstStep.message=typeof message==='function'?message():message;chatSteps[firstStep.id].message=firstStep.message;}var recognitionEnable=this.state.recognitionEnable;var recognitionLang=this.props.recognitionLang;if(recognitionEnable){this.recognition=new Recognition(this.onRecognitionChange,this.onRecognitionEnd,this.onRecognitionStop,recognitionLang);}this.supportsScrollBehavior='scrollBehavior'in document.documentElement.style;if(this.content){this.content.addEventListener('DOMNodeInserted',this.onNodeInserted);window.addEventListener('resize',this.onResize);}var _storage$getData=storage.getData({cacheName:cacheName,cache:cache,firstStep:firstStep,steps:chatSteps},function(){// focus input if last step cached is a user step\n_this2.setState({disabled:false},function(){if(enableMobileAutoFocus||!isMobile()){if(_this2.input){_this2.input.focus();}}});}),currentStep=_storage$getData.currentStep,previousStep=_storage$getData.previousStep,previousSteps=_storage$getData.previousSteps,renderedSteps=_storage$getData.renderedSteps;this.setState({currentStep:currentStep,defaultUserSettings:defaultUserSettings,previousStep:previousStep,previousSteps:previousSteps,renderedSteps:renderedSteps,steps:chatSteps});}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){if(this.content){this.content.removeEventListener('DOMNodeInserted',this.onNodeInserted);window.removeEventListener('resize',this.onResize);}}},{key:\"render\",value:function render(){var _this3=this;var _this$state6=this.state,currentStep=_this$state6.currentStep,disabled=_this$state6.disabled,inputInvalid=_this$state6.inputInvalid,inputValue=_this$state6.inputValue,opened=_this$state6.opened,renderedSteps=_this$state6.renderedSteps,speaking=_this$state6.speaking,recognitionEnable=_this$state6.recognitionEnable;var _this$props4=this.props,className=_this$props4.className,contentStyle=_this$props4.contentStyle,extraControl=_this$props4.extraControl,controlStyle=_this$props4.controlStyle,floating=_this$props4.floating,floatingIcon=_this$props4.floatingIcon,floatingStyle=_this$props4.floatingStyle,footerStyle=_this$props4.footerStyle,headerComponent=_this$props4.headerComponent,headerTitle=_this$props4.headerTitle,hideHeader=_this$props4.hideHeader,hideSubmitButton=_this$props4.hideSubmitButton,inputStyle=_this$props4.inputStyle,placeholder=_this$props4.placeholder,inputAttributes=_this$props4.inputAttributes,recognitionPlaceholder=_this$props4.recognitionPlaceholder,style=_this$props4.style,submitButtonStyle=_this$props4.submitButtonStyle,width=_this$props4.width,height=_this$props4.height;var header=headerComponent||/*#__PURE__*/_jsxs(Header,{className:\"rsc-header\",children:[/*#__PURE__*/_jsx(HeaderTitle,{className:\"rsc-header-title\",children:headerTitle}),floating&&/*#__PURE__*/_jsx(HeaderIcon,{className:\"rsc-header-close-button\",onClick:function onClick(){return _this3.toggleChatBot(false);},children:/*#__PURE__*/_jsx(CloseIcon,{})})]});var customControl;if(extraControl!==undefined){customControl=/*#__PURE__*/React.cloneElement(extraControl,{disabled:disabled,speaking:speaking,invalid:inputInvalid});}var icon=(this.isInputValueEmpty()||speaking)&&recognitionEnable?/*#__PURE__*/_jsx(MicIcon,{}):/*#__PURE__*/_jsx(SubmitIcon,{});var inputPlaceholder=speaking?recognitionPlaceholder:currentStep.placeholder||placeholder;var inputAttributesOverride=currentStep.inputAttributes||inputAttributes;return/*#__PURE__*/_jsxs(\"div\",{className:\"rsc \".concat(className),children:[floating&&/*#__PURE__*/_jsx(FloatButton,{className:\"rsc-float-button\",style:floatingStyle,opened:opened,onClick:function onClick(){return _this3.toggleChatBot(true);},children:typeof floatingIcon==='string'?/*#__PURE__*/_jsx(FloatingIcon,{src:floatingIcon}):floatingIcon}),/*#__PURE__*/_jsxs(ChatBotContainer,{className:\"rsc-container\",floating:floating,floatingStyle:floatingStyle,opened:opened,style:style,width:width,height:height,children:[!hideHeader&&header,/*#__PURE__*/_jsx(Content,{className:\"rsc-content\",ref:this.setContentRef,floating:floating,style:contentStyle,height:height,hideInput:currentStep.hideInput,children:renderedSteps.map(this.renderStep)}),/*#__PURE__*/_jsxs(Footer,{className:\"rsc-footer\",style:footerStyle,children:[!currentStep.hideInput&&/*#__PURE__*/_jsx(Input,_objectSpread({type:\"textarea\",style:inputStyle,ref:this.setInputRef,className:\"rsc-input\",placeholder:inputInvalid?'':inputPlaceholder,onKeyPress:this.handleKeyPress,onChange:this.onValueChange,value:inputValue,floating:floating,invalid:inputInvalid,disabled:disabled,hasButton:!hideSubmitButton},inputAttributesOverride)),/*#__PURE__*/_jsxs(\"div\",{style:controlStyle,className:\"rsc-controls\",children:[!currentStep.hideInput&&!currentStep.hideExtraControl&&customControl,!currentStep.hideInput&&!hideSubmitButton&&/*#__PURE__*/_jsx(SubmitButton,{className:\"rsc-submit-button\",style:submitButtonStyle,onClick:this.handleSubmitButton,invalid:inputInvalid,disabled:disabled,speaking:speaking,children:icon})]})]})]})]});}}],[{key:\"getDerivedStateFromProps\",value:function getDerivedStateFromProps(props,state){var opened=props.opened,toggleFloating=props.toggleFloating;if(toggleFloating!==undefined&&opened!==undefined&&opened!==state.opened){return _objectSpread(_objectSpread({},state),{},{opened:opened});}return state;}}]);return ChatBot;}(Component);ChatBot.defaultProps={avatarStyle:{},botDelay:1000,botName:'The bot',bubbleOptionStyle:{},bubbleStyle:{},cache:false,cacheName:'rsc_cache',className:'',contentStyle:{},customStyle:{},controlStyle:{position:'absolute',right:'0',top:'0'},customDelay:1000,enableMobileAutoFocus:false,enableSmoothScroll:false,extraControl:undefined,floating:false,floatingIcon:/*#__PURE__*/_jsx(ChatIcon,{}),floatingStyle:{},footerStyle:{},handleEnd:undefined,headerComponent:undefined,headerTitle:'Chat',height:'520px',hideBotAvatar:false,hideHeader:false,hideSubmitButton:false,hideUserAvatar:false,inputStyle:{},opened:undefined,placeholder:'Type the message ...',inputAttributes:{},recognitionEnable:false,recognitionLang:'en',recognitionPlaceholder:'Listening ...',speechSynthesis:{enable:false,lang:'en',voice:null},style:{},submitButtonStyle:{},toggleFloating:undefined,userDelay:1000,width:'350px',botAvatar:\"data:image/svg+xml,%3csvg version='1' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3e%3cpath d='M303 70a47 47 0 1 0-70 40v84h46v-84c14-8 24-23 24-40z' fill='%2393c7ef'/%3e%3cpath d='M256 23v171h23v-84a47 47 0 0 0-23-87z' fill='%235a8bb0'/%3e%3cpath fill='%2393c7ef' d='M0 240h248v124H0z'/%3e%3cpath fill='%235a8bb0' d='M264 240h248v124H264z'/%3e%3cpath fill='%2393c7ef' d='M186 365h140v124H186z'/%3e%3cpath fill='%235a8bb0' d='M256 365h70v124h-70z'/%3e%3cpath fill='%23cce9f9' d='M47 163h419v279H47z'/%3e%3cpath fill='%2393c7ef' d='M256 163h209v279H256z'/%3e%3cpath d='M194 272a31 31 0 0 1-62 0c0-18 14-32 31-32s31 14 31 32z' fill='%233c5d76'/%3e%3cpath d='M380 272a31 31 0 0 1-62 0c0-18 14-32 31-32s31 14 31 32z' fill='%231e2e3b'/%3e%3cpath d='M186 349a70 70 0 1 0 140 0H186z' fill='%233c5d76'/%3e%3cpath d='M256 349v70c39 0 70-31 70-70h-70z' fill='%231e2e3b'/%3e%3c/svg%3e\",userAvatar:\"data:image/svg+xml,%3csvg viewBox='-208.5 21 100 100' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3ccircle cx='-158.5' cy='71' fill='%23F5EEE5' r='50'/%3e%3cdefs%3e%3ccircle cx='-158.5' cy='71' id='a' r='50'/%3e%3c/defs%3e%3cclipPath id='b'%3e%3cuse overflow='visible' xlink:href='%23a'/%3e%3c/clipPath%3e%3cpath clip-path='url(%23b)' d='M-108.5 121v-14s-21.2-4.9-28-6.7c-2.5-.7-7-3.3-7-12V82h-30v6.3c0 8.7-4.5 11.3-7 12-6.8 1.9-28.1 7.3-28.1 6.7v14h100.1z' fill='%23E6C19C'/%3e%3cg clip-path='url(%23b)'%3e%3cdefs%3e%3cpath d='M-108.5 121v-14s-21.2-4.9-28-6.7c-2.5-.7-7-3.3-7-12V82h-30v6.3c0 8.7-4.5 11.3-7 12-6.8 1.9-28.1 7.3-28.1 6.7v14h100.1z' id='c'/%3e%3c/defs%3e%3cclipPath id='d'%3e%3cuse overflow='visible' xlink:href='%23c'/%3e%3c/clipPath%3e%3cpath clip-path='url(%23d)' d='M-158.5 100.1c12.7 0 23-18.6 23-34.4 0-16.2-10.3-24.7-23-24.7s-23 8.5-23 24.7c0 15.8 10.3 34.4 23 34.4z' fill='%23D4B08C'/%3e%3c/g%3e%3cpath d='M-158.5 96c12.7 0 23-16.3 23-31 0-15.1-10.3-23-23-23s-23 7.9-23 23c0 14.7 10.3 31 23 31z' fill='%23F2CEA5'/%3e%3c/svg%3e\"};export default ChatBot;","map":{"version":3,"sources":["C:/Users/TheTOP/Documents/GitHub/pizza-chatbot-chk4/src/components/chatbot/ChatBot.jsx"],"names":["React","Component","Random","CustomStep","OptionsStep","TextStep","schema","storage","ChatBotContainer","Content","Header","HeaderTitle","HeaderIcon","FloatButton","FloatingIcon","Footer","Input","SubmitButton","Recognition","ChatIcon","CloseIcon","SubmitIcon","MicIcon","isMobile","speakFn","ChatBot","props","onNodeInserted","event","target","currentTarget","enableSmoothScroll","supportsScrollBehavior","scroll","top","scrollHeight","left","behavior","scrollTop","onResize","content","onRecognitionChange","value","setState","inputValue","onRecognitionEnd","speaking","handleSubmitButton","onRecognitionStop","onValueChange","getTriggeredStep","trigger","steps","generateRenderedStepsById","getStepMessage","message","previousSteps","state","lastStepIndex","length","previousValue","i","len","id","metadata","triggerNextStep","data","enableMobileAutoFocus","defaultUserSettings","renderedSteps","currentStep","previousStep","isEnd","end","hideInput","hideExtraControl","handleEnd","options","option","filter","o","Object","assign","user","label","pop","push","replace","val","msg","userMsg","stepMsg","botStepMsg","hasUserMessage","preserveMsg","isSpecialStep","hasOwnProperty","defaultBotSettings","delay","avatar","botAvatar","botName","thisStepMsg","key","nextS","rendered","component","settings","out","nextStep","update","updateStep","disabled","input","focus","cache","cacheName","setTimeout","setData","map","step","values","isInputValueEmpty","isLastPosition","stepIndex","s","indexOf","hasMessage","asMessage","isLast","isFirstPosition","lastStep","isFirst","handleKeyPress","submitUserMessage","recognitionEnable","recognition","speak","isInvalid","validator","checkInvalidInput","blur","result","toString","inputInvalid","toggleChatBot","opened","toggleFloating","renderStep","index","avatarStyle","bubbleStyle","bubbleOptionStyle","customStyle","hideBotAvatar","hideUserAvatar","speechSynthesis","setContentRef","element","setInputRef","floating","isSupported","botDelay","customDelay","userAvatar","userDelay","chatSteps","defaultCustomSettings","parse","checkInvalidIds","firstStep","recognitionLang","document","documentElement","style","addEventListener","window","getData","removeEventListener","className","contentStyle","extraControl","controlStyle","floatingIcon","floatingStyle","footerStyle","headerComponent","headerTitle","hideHeader","hideSubmitButton","inputStyle","placeholder","inputAttributes","recognitionPlaceholder","submitButtonStyle","width","height","header","customControl","undefined","cloneElement","invalid","icon","inputPlaceholder","inputAttributesOverride","defaultProps","position","right","enable","lang","voice"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Random from 'random-id';\r\nimport { CustomStep, OptionsStep, TextStep } from './steps_components';\r\nimport schema from './schemas/schema';\r\nimport * as storage from './storage';\r\nimport {\r\n  ChatBotContainer,\r\n  Content,\r\n  Header,\r\n  HeaderTitle,\r\n  HeaderIcon,\r\n  FloatButton,\r\n  FloatingIcon,\r\n  Footer,\r\n  Input,\r\n  SubmitButton\r\n} from './components';\r\nimport Recognition from './recognition';\r\nimport { ChatIcon, CloseIcon, SubmitIcon, MicIcon } from './icons';\r\nimport { isMobile } from './utils';\r\nimport { speakFn } from './speechSynthesis';\r\nclass ChatBot extends Component {\r\n  /* istanbul ignore next */\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.content = null;\r\n    this.input = null;\r\n\r\n    this.supportsScrollBehavior = false;\r\n\r\n    this.setContentRef = element => {\r\n      this.content = element;\r\n    };\r\n\r\n    this.setInputRef = element => {\r\n      this.input = element;\r\n    };\r\n\r\n    this.state = {\r\n      renderedSteps: [],\r\n      previousSteps: [],\r\n      currentStep: {},\r\n      previousStep: {},\r\n      steps: {},\r\n      disabled: true,\r\n      opened: props.opened || !props.floating,\r\n      inputValue: '',\r\n      inputInvalid: false,\r\n      speaking: false,\r\n      recognitionEnable: props.recognitionEnable && Recognition.isSupported(),\r\n      defaultUserSettings: {}\r\n    };\r\n\r\n    this.speak = speakFn(props.speechSynthesis);\r\n  }\r\n\r\n  componentDidMount() {\r\n    const { steps } = this.props;\r\n    const {\r\n      botDelay,\r\n      botAvatar,\r\n      botName,\r\n      cache,\r\n      cacheName,\r\n      customDelay,\r\n      enableMobileAutoFocus,\r\n      userAvatar,\r\n      userDelay\r\n    } = this.props;\r\n    const chatSteps = {};\r\n\r\n    const defaultBotSettings = { delay: botDelay, avatar: botAvatar, botName };\r\n    const defaultUserSettings = {\r\n      delay: userDelay,\r\n      avatar: userAvatar,\r\n      hideInput: false,\r\n      hideExtraControl: false\r\n    };\r\n    const defaultCustomSettings = { delay: customDelay };\r\n\r\n    for (let i = 0, len = steps.length; i < len; i += 1) {\r\n      const step = steps[i];\r\n      let settings = {};\r\n\r\n      if (step.user) {\r\n        settings = defaultUserSettings;\r\n      } else if (step.message || step.asMessage) {\r\n        settings = defaultBotSettings;\r\n      } else if (step.component) {\r\n        settings = defaultCustomSettings;\r\n      }\r\n\r\n      chatSteps[step.id] = Object.assign({}, settings, schema.parse(step));\r\n    }\r\n\r\n    schema.checkInvalidIds(chatSteps);\r\n\r\n    const firstStep = steps[0];\r\n\r\n    if (firstStep.message) {\r\n      const { message } = firstStep;\r\n      firstStep.message = typeof message === 'function' ? message() : message;\r\n      chatSteps[firstStep.id].message = firstStep.message;\r\n    }\r\n\r\n    const { recognitionEnable } = this.state;\r\n    const { recognitionLang } = this.props;\r\n\r\n    if (recognitionEnable) {\r\n      this.recognition = new Recognition(\r\n        this.onRecognitionChange,\r\n        this.onRecognitionEnd,\r\n        this.onRecognitionStop,\r\n        recognitionLang\r\n      );\r\n    }\r\n\r\n    this.supportsScrollBehavior = 'scrollBehavior' in document.documentElement.style;\r\n\r\n    if (this.content) {\r\n      this.content.addEventListener('DOMNodeInserted', this.onNodeInserted);\r\n      window.addEventListener('resize', this.onResize);\r\n    }\r\n\r\n    const { currentStep, previousStep, previousSteps, renderedSteps } = storage.getData(\r\n      {\r\n        cacheName,\r\n        cache,\r\n        firstStep,\r\n        steps: chatSteps\r\n      },\r\n      () => {\r\n        // focus input if last step cached is a user step\r\n        this.setState({ disabled: false }, () => {\r\n          if (enableMobileAutoFocus || !isMobile()) {\r\n            if (this.input) {\r\n              this.input.focus();\r\n            }\r\n          }\r\n        });\r\n      }\r\n    );\r\n\r\n    this.setState({\r\n      currentStep,\r\n      defaultUserSettings,\r\n      previousStep,\r\n      previousSteps,\r\n      renderedSteps,\r\n      steps: chatSteps\r\n    });\r\n  }\r\n\r\n  static getDerivedStateFromProps(props, state) {\r\n    const { opened, toggleFloating } = props;\r\n    if (toggleFloating !== undefined && opened !== undefined && opened !== state.opened) {\r\n      return {\r\n        ...state,\r\n        opened\r\n      };\r\n    }\r\n    return state;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.content) {\r\n      this.content.removeEventListener('DOMNodeInserted', this.onNodeInserted);\r\n      window.removeEventListener('resize', this.onResize);\r\n    }\r\n  }\r\n\r\n  onNodeInserted = event => {\r\n    const { currentTarget: target } = event;\r\n    const { enableSmoothScroll } = this.props;\r\n\r\n    if (enableSmoothScroll && this.supportsScrollBehavior) {\r\n      target.scroll({\r\n        top: target.scrollHeight,\r\n        left: 0,\r\n        behavior: 'smooth'\r\n      });\r\n    } else {\r\n      target.scrollTop = target.scrollHeight;\r\n    }\r\n  };\r\n\r\n  onResize = () => {\r\n    this.content.scrollTop = this.content.scrollHeight;\r\n  };\r\n\r\n  onRecognitionChange = value => {\r\n    this.setState({ inputValue: value });\r\n  };\r\n\r\n  onRecognitionEnd = () => {\r\n    this.setState({ speaking: false });\r\n    this.handleSubmitButton();\r\n  };\r\n\r\n  onRecognitionStop = () => {\r\n    this.setState({ speaking: false });\r\n  };\r\n\r\n  onValueChange = event => {\r\n    this.setState({ inputValue: event.target.value });\r\n  };\r\n\r\n  getTriggeredStep = (trigger, value) => {\r\n    const steps = this.generateRenderedStepsById();\r\n    return typeof trigger === 'function' ? trigger({ value, steps }) : trigger;\r\n  };\r\n\r\n  getStepMessage = message => {\r\n    const { previousSteps } = this.state;\r\n    const lastStepIndex = previousSteps.length > 0 ? previousSteps.length - 1 : 0;\r\n    const steps = this.generateRenderedStepsById();\r\n    const previousValue = previousSteps[lastStepIndex].value;\r\n    return typeof message === 'function' ? message({ previousValue, steps }) : message;\r\n  };\r\n\r\n  generateRenderedStepsById = () => {\r\n    const { previousSteps } = this.state;\r\n    const steps = {};\r\n\r\n    for (let i = 0, len = previousSteps.length; i < len; i += 1) {\r\n      const { id, message, value, metadata } = previousSteps[i];\r\n\r\n      steps[id] = {\r\n        id,\r\n        message,\r\n        value,\r\n        metadata\r\n      };\r\n    }\r\n\r\n    return steps;\r\n  };\r\n\r\n  triggerNextStep = data => {\r\n    const { enableMobileAutoFocus } = this.props;\r\n    const { defaultUserSettings, previousSteps, renderedSteps, steps } = this.state;\r\n\r\n    let { currentStep, previousStep } = this.state;\r\n    const isEnd = currentStep.end;\r\n    \r\n    if (data && data.value) {\r\n      currentStep.value = data.value;\r\n    }\r\n    if (data && data.hideInput) {\r\n      currentStep.hideInput = data.hideInput;\r\n    }\r\n    if (data && data.hideExtraControl) {\r\n      currentStep.hideExtraControl = data.hideExtraControl;\r\n    }\r\n    if (data && data.trigger) {\r\n      currentStep.trigger = this.getTriggeredStep(data.trigger, data.value);\r\n    }\r\n\r\n    if (isEnd) {\r\n      this.handleEnd();\r\n    } else if (currentStep.options && data) {\r\n      const option = currentStep.options.filter(o => o.value === data.value)[0];\r\n      const trigger = this.getTriggeredStep(option.trigger, currentStep.value);\r\n      delete currentStep.options;\r\n      \r\n      // replace choose option for user message\r\n      currentStep = Object.assign({}, currentStep, option, defaultUserSettings, {\r\n        user: true,\r\n        message: option.label,\r\n        trigger\r\n      });     \r\n      renderedSteps.pop();\r\n      previousSteps.pop();\r\n      renderedSteps.push(currentStep);\r\n      previousSteps.push(currentStep);\r\n\r\n      this.setState({\r\n        currentStep,\r\n        renderedSteps,\r\n        previousSteps\r\n      });\r\n    } else if (currentStep.trigger && currentStep.replace && data) {\r\n        const trigger = this.getTriggeredStep(currentStep.trigger, currentStep.value);      \r\n        const val = currentStep.value;\r\n        const msg = data.userMsg;//user message\r\n        const stepMsg = data.botStepMsg; //bot message\r\n        const hasUserMessage = data.preserveMsg;\r\n        const isSpecialStep = data.hasOwnProperty('isSpecialStep')?data.isSpecialStep:false;\r\n        const defaultBotSettings = { delay: 0, avatar: this.props.botAvatar, botName: this.props.botName };\r\n\r\n        //delete currentStep.component;  \r\n        if(hasUserMessage){        \r\n          const thisStepMsg = {id:currentStep.id, key: currentStep.key, msg: stepMsg, trigger: ''};\r\n          const nextS = Object.assign({}, thisStepMsg, 0, defaultBotSettings, {\r\n            user: false,\r\n            message: stepMsg,\r\n            rendered:true,\r\n            \r\n          }); \r\n          delete currentStep.component;\r\n          delete currentStep.trigger;\r\n\r\n          currentStep = Object.assign({}, currentStep, val, defaultUserSettings, {\r\n            user: true,\r\n            message: msg,\r\n            trigger: trigger,            \r\n          });\r\n          renderedSteps.pop();\r\n          previousSteps.pop();\r\n          renderedSteps.push(nextS);\r\n          previousSteps.push(nextS);\r\n          renderedSteps.push(currentStep);\r\n          previousSteps.push(currentStep);\r\n          this.setState({\r\n            currentStep,\r\n            renderedSteps,\r\n            previousSteps\r\n          });\r\n        }/* else if(isSpecialStep){\r\n          delete currentStep.component;              \r\n          const previousStep = this.state.previousStep;\r\n          const out = hasUserMessage?msg:stepMsg;\r\n          \r\n          const thisStepMsg = {id:previousStep.id, key: previousStep.key, msg: previousStep.value, trigger: \"\"};\r\n          const nextS = Object.assign({}, thisStepMsg, 0, defaultUserSettings, {\r\n            user: true,\r\n            message: previousStep.value,\r\n            rendered:isSpecialStep,           \r\n            \r\n          });\r\n\r\n          currentStep = Object.assign({}, currentStep, val, defaultBotSettings, {\r\n            user: hasUserMessage,\r\n            message: out,\r\n            rendered:false,\r\n            \r\n          });\r\n          renderedSteps.pop();\r\n          previousSteps.pop();\r\n          renderedSteps.pop();\r\n          previousSteps.pop();\r\n          renderedSteps.push(nextS);\r\n          previousSteps.push(nextS);\r\n          renderedSteps.push(currentStep);\r\n          previousSteps.push(currentStep);\r\n          \r\n          this.setState({\r\n            currentStep,\r\n            renderedSteps,\r\n            previousSteps\r\n          });\r\n        \r\n        } */else {\r\n          delete currentStep.component;\r\n              \r\n          const settings = hasUserMessage?defaultUserSettings:defaultBotSettings;\r\n          const out = hasUserMessage?msg:stepMsg;\r\n          currentStep = Object.assign({}, currentStep, val, settings, {\r\n            user: hasUserMessage,\r\n            message: out,\r\n            trigger,\r\n            \r\n          }); \r\n          \r\n          renderedSteps.pop();\r\n          previousSteps.pop();\r\n          renderedSteps.push(currentStep);\r\n          previousSteps.push(currentStep);\r\n          \r\n          this.setState({\r\n            currentStep,\r\n            renderedSteps,\r\n            previousSteps\r\n          });\r\n        }\r\n      } else if (currentStep.trigger) {      \r\n      \r\n       const trigger = this.getTriggeredStep(currentStep.trigger, currentStep.value);  \r\n        let nextStep = Object.assign({}, steps[trigger]);\r\n     \r\n      if (nextStep.message) {\r\n        nextStep.message = this.getStepMessage(nextStep.message);\r\n      } else if (nextStep.update) {\r\n        const updateStep = nextStep;\r\n        nextStep = Object.assign({}, steps[updateStep.update]);\r\n\r\n        if (nextStep.options) {\r\n          for (let i = 0, len = nextStep.options.length; i < len; i += 1) {\r\n            nextStep.options[i].trigger = updateStep.trigger;\r\n          }\r\n        } else {\r\n          nextStep.trigger = updateStep.trigger;\r\n        }\r\n      }\r\n\r\n      nextStep.key = Random(24);\r\n\r\n      previousStep = currentStep;\r\n      currentStep = nextStep;\r\n\r\n      this.setState({ renderedSteps, currentStep, previousStep }, () => {\r\n        if (nextStep.user) {\r\n          this.setState({ disabled: false }, () => {\r\n            if (enableMobileAutoFocus || !isMobile()) {\r\n              if (this.input) {\r\n                this.input.focus();\r\n              }\r\n            }\r\n          });\r\n        } else {\r\n          renderedSteps.push(nextStep);\r\n          previousSteps.push(nextStep);\r\n\r\n          this.setState({ renderedSteps, previousSteps });\r\n        }\r\n      });\r\n    }\r\n\r\n    const { cache, cacheName } = this.props;\r\n    if (cache) {\r\n      setTimeout(() => {\r\n        storage.setData(cacheName, {\r\n          currentStep,\r\n          previousStep,\r\n          previousSteps,\r\n          renderedSteps\r\n        });\r\n      }, 300);\r\n    }\r\n  };\r\n\r\n  handleEnd = () => {\r\n    const { handleEnd } = this.props;\r\n\r\n    if (handleEnd) {\r\n      const { previousSteps } = this.state;\r\n\r\n      const renderedSteps = previousSteps.map(step => {\r\n        const { id, message, value, metadata } = step;\r\n\r\n        return {\r\n          id,\r\n          message,\r\n          value,\r\n          metadata\r\n        };\r\n      });\r\n\r\n      const steps = [];\r\n\r\n      for (let i = 0, len = previousSteps.length; i < len; i += 1) {\r\n        const { id, message, value, metadata } = previousSteps[i];\r\n\r\n        steps[id] = {\r\n          id,\r\n          message,\r\n          value,\r\n          metadata\r\n        };\r\n      }\r\n\r\n      const values = previousSteps.filter(step => step.value).map(step => step.value);\r\n\r\n      handleEnd({ renderedSteps, steps, values });\r\n    }\r\n  };\r\n\r\n  isInputValueEmpty = () => {\r\n    const { inputValue } = this.state;\r\n    return !inputValue || inputValue.length === 0;\r\n  };\r\n\r\n  isLastPosition = step => {\r\n    const { renderedSteps } = this.state;\r\n    const { length } = renderedSteps;\r\n    const stepIndex = renderedSteps.map(s => s.key).indexOf(step.key);\r\n\r\n    if (length <= 1 || stepIndex + 1 === length) {\r\n      return true;\r\n    }\r\n\r\n    const nextStep = renderedSteps[stepIndex + 1];\r\n    const hasMessage = nextStep.message || nextStep.asMessage;\r\n\r\n    if (!hasMessage) {\r\n      return true;\r\n    }\r\n\r\n    const isLast = step.user !== nextStep.user;\r\n    return isLast;\r\n  };\r\n\r\n  isFirstPosition = step => {\r\n    const { renderedSteps } = this.state;\r\n    const stepIndex = renderedSteps.map(s => s.key).indexOf(step.key);\r\n\r\n    if (stepIndex === 0) {\r\n      return true;\r\n    }\r\n\r\n    const lastStep = renderedSteps[stepIndex - 1];\r\n    const hasMessage = lastStep.message || lastStep.asMessage;\r\n\r\n    if (!hasMessage) {\r\n      return true;\r\n    }\r\n\r\n    const isFirst = step.user !== lastStep.user;\r\n    return isFirst;\r\n  };\r\n\r\n  handleKeyPress = event => {\r\n    if (event.key === 'Enter') {\r\n      this.submitUserMessage();\r\n    }\r\n  };\r\n\r\n  handleSubmitButton = () => {\r\n    const { speaking, recognitionEnable } = this.state;\r\n\r\n    if ((this.isInputValueEmpty() || speaking) && recognitionEnable) {\r\n      this.recognition.speak();\r\n      if (!speaking) {\r\n        this.setState({ speaking: true });\r\n      }\r\n      return;\r\n    }\r\n\r\n    this.submitUserMessage();\r\n  };\r\n\r\n  submitUserMessage = () => {\r\n    const { defaultUserSettings, inputValue, previousSteps, renderedSteps } = this.state;\r\n    let { currentStep } = this.state;\r\n\r\n    const isInvalid = currentStep.validator && this.checkInvalidInput();\r\n\r\n    if (!isInvalid) {\r\n      const step = {\r\n        message: inputValue,\r\n        value: inputValue\r\n      };\r\n\r\n      currentStep = Object.assign({}, defaultUserSettings, currentStep, step);\r\n\r\n      renderedSteps.push(currentStep);\r\n      previousSteps.push(currentStep);\r\n\r\n      this.setState(\r\n        {\r\n          currentStep,\r\n          renderedSteps,\r\n          previousSteps,\r\n          disabled: true,\r\n          inputValue: ''\r\n        },\r\n        () => {\r\n          if (this.input) {\r\n            this.input.blur();\r\n          }\r\n        }\r\n      );\r\n    }\r\n  };\r\n\r\n  checkInvalidInput = () => {\r\n    const { enableMobileAutoFocus } = this.props;\r\n    const { currentStep, inputValue } = this.state;\r\n    const result = currentStep.validator(inputValue);\r\n    const value = inputValue;\r\n\r\n    if (typeof result !== 'boolean' || !result) {\r\n      this.setState(\r\n        {\r\n          inputValue: result.toString(),\r\n          inputInvalid: true,\r\n          disabled: true\r\n        },\r\n        () => {\r\n          setTimeout(() => {\r\n            this.setState(\r\n              {\r\n                inputValue: value,\r\n                inputInvalid: false,\r\n                disabled: false\r\n              },\r\n              () => {\r\n                if (enableMobileAutoFocus || !isMobile()) {\r\n                  if (this.input) {\r\n                    this.input.focus();\r\n                  }\r\n                }\r\n              }\r\n            );\r\n          }, 2000);\r\n        }\r\n      );\r\n\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  };\r\n\r\n  toggleChatBot = opened => {\r\n    const { toggleFloating } = this.props;\r\n\r\n    if (toggleFloating) {\r\n      toggleFloating({ opened });\r\n    } else {\r\n      this.setState({ opened });\r\n    }\r\n  };\r\n\r\n  renderStep = (step, index) => {\r\n    const { renderedSteps } = this.state;\r\n    const {\r\n      avatarStyle,\r\n      bubbleStyle,\r\n      bubbleOptionStyle,\r\n      customStyle,\r\n      hideBotAvatar,\r\n      hideUserAvatar,\r\n      speechSynthesis\r\n    } = this.props;\r\n    const { options, component, asMessage } = step;\r\n    const steps = this.generateRenderedStepsById();\r\n    const previousStep = index > 0 ? renderedSteps[index - 1] : {};\r\n\r\n    if (component && !asMessage) {\r\n      return (\r\n        <CustomStep\r\n          key={index}\r\n          speak={this.speak}\r\n          step={step}\r\n          steps={steps}\r\n          style={customStyle}\r\n          previousStep={previousStep}\r\n          previousValue={previousStep.value}\r\n          triggerNextStep={this.triggerNextStep}\r\n        />\r\n      );\r\n    }\r\n\r\n    if (options) {\r\n      return (\r\n        <OptionsStep\r\n          key={index}\r\n          step={step}\r\n          previousValue={previousStep.value}\r\n          triggerNextStep={this.triggerNextStep}\r\n          bubbleOptionStyle={bubbleOptionStyle}\r\n        />\r\n      );\r\n    }\r\n\r\n    return (\r\n      <TextStep\r\n        key={index}\r\n        step={step}\r\n        steps={steps}\r\n        speak={this.speak}\r\n        previousStep={previousStep}\r\n        previousValue={previousStep.value}\r\n        triggerNextStep={this.triggerNextStep}\r\n        avatarStyle={avatarStyle}\r\n        bubbleStyle={bubbleStyle}\r\n        hideBotAvatar={hideBotAvatar}\r\n        hideUserAvatar={hideUserAvatar}\r\n        speechSynthesis={speechSynthesis}\r\n        isFirst={this.isFirstPosition(step)}\r\n        isLast={this.isLastPosition(step)}\r\n      />\r\n    );\r\n  };\r\n\r\n  render() {\r\n    const {\r\n      currentStep,\r\n      disabled,\r\n      inputInvalid,\r\n      inputValue,\r\n      opened,\r\n      renderedSteps,\r\n      speaking,\r\n      recognitionEnable\r\n    } = this.state;\r\n    const {\r\n      className,\r\n      contentStyle,\r\n      extraControl,\r\n      controlStyle,\r\n      floating,\r\n      floatingIcon,\r\n      floatingStyle,\r\n      footerStyle,\r\n      headerComponent,\r\n      headerTitle,\r\n      hideHeader,\r\n      hideSubmitButton,\r\n      inputStyle,\r\n      placeholder,\r\n      inputAttributes,\r\n      recognitionPlaceholder,\r\n      style,\r\n      submitButtonStyle,\r\n      width,\r\n      height\r\n    } = this.props;\r\n\r\n    const header = headerComponent || (\r\n      <Header className=\"rsc-header\">\r\n        <HeaderTitle className=\"rsc-header-title\">{headerTitle}</HeaderTitle>\r\n        {floating && (\r\n          <HeaderIcon className=\"rsc-header-close-button\" onClick={() => this.toggleChatBot(false)}>\r\n            <CloseIcon />\r\n          </HeaderIcon>\r\n        )}\r\n      </Header>\r\n    );\r\n\r\n    let customControl;\r\n    if (extraControl !== undefined) {\r\n      customControl = React.cloneElement(extraControl, {\r\n        disabled,\r\n        speaking,\r\n        invalid: inputInvalid\r\n      });\r\n    }\r\n\r\n    const icon =\r\n      (this.isInputValueEmpty() || speaking) && recognitionEnable ? <MicIcon /> : <SubmitIcon />;\r\n\r\n    const inputPlaceholder = speaking\r\n      ? recognitionPlaceholder\r\n      : currentStep.placeholder || placeholder;\r\n\r\n    const inputAttributesOverride = currentStep.inputAttributes || inputAttributes;\r\n\r\n    return (\r\n      <div className={`rsc ${className}`}>\r\n        {floating && (\r\n          <FloatButton\r\n            className=\"rsc-float-button\"\r\n            style={floatingStyle}\r\n            opened={opened}\r\n            onClick={() => this.toggleChatBot(true)}\r\n          >\r\n            {typeof floatingIcon === 'string' ? <FloatingIcon src={floatingIcon} /> : floatingIcon}\r\n          </FloatButton>\r\n        )}\r\n        <ChatBotContainer\r\n          className=\"rsc-container\"\r\n          floating={floating}\r\n          floatingStyle={floatingStyle}\r\n          opened={opened}\r\n          style={style}\r\n          width={width}\r\n          height={height}\r\n        >\r\n          {!hideHeader && header}\r\n          <Content\r\n            className=\"rsc-content\"\r\n            ref={this.setContentRef}\r\n            floating={floating}\r\n            style={contentStyle}\r\n            height={height}\r\n            hideInput={currentStep.hideInput}\r\n          >\r\n            {renderedSteps.map(this.renderStep)}\r\n          </Content>\r\n          <Footer className=\"rsc-footer\" style={footerStyle}>\r\n            {!currentStep.hideInput && (\r\n              <Input\r\n                type=\"textarea\"\r\n                style={inputStyle}\r\n                ref={this.setInputRef}\r\n                className=\"rsc-input\"\r\n                placeholder={inputInvalid ? '' : inputPlaceholder}\r\n                onKeyPress={this.handleKeyPress}\r\n                onChange={this.onValueChange}\r\n                value={inputValue}\r\n                floating={floating}\r\n                invalid={inputInvalid}\r\n                disabled={disabled}\r\n                hasButton={!hideSubmitButton}\r\n                {...inputAttributesOverride}\r\n              />\r\n            )}\r\n            <div style={controlStyle} className=\"rsc-controls\">\r\n              {!currentStep.hideInput && !currentStep.hideExtraControl && customControl}\r\n              {!currentStep.hideInput && !hideSubmitButton && (\r\n                <SubmitButton\r\n                  className=\"rsc-submit-button\"\r\n                  style={submitButtonStyle}\r\n                  onClick={this.handleSubmitButton}\r\n                  invalid={inputInvalid}\r\n                  disabled={disabled}\r\n                  speaking={speaking}\r\n                >\r\n                  {icon}\r\n                </SubmitButton>\r\n              )}\r\n            </div>\r\n          </Footer>\r\n        </ChatBotContainer>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nChatBot.propTypes = {\r\n  avatarStyle: PropTypes.objectOf(PropTypes.any),\r\n  botAvatar: PropTypes.string,\r\n  botName: PropTypes.string,\r\n  botDelay: PropTypes.number,\r\n  bubbleOptionStyle: PropTypes.objectOf(PropTypes.any),\r\n  bubbleStyle: PropTypes.objectOf(PropTypes.any),\r\n  cache: PropTypes.bool,\r\n  cacheName: PropTypes.string,\r\n  className: PropTypes.string,\r\n  contentStyle: PropTypes.objectOf(PropTypes.any),\r\n  customDelay: PropTypes.number,\r\n  customStyle: PropTypes.objectOf(PropTypes.any),\r\n  controlStyle: PropTypes.objectOf(PropTypes.any),\r\n  enableMobileAutoFocus: PropTypes.bool,\r\n  enableSmoothScroll: PropTypes.bool,\r\n  extraControl: PropTypes.objectOf(PropTypes.element),\r\n  floating: PropTypes.bool,\r\n  floatingIcon: PropTypes.oneOfType([PropTypes.string, PropTypes.element]),\r\n  floatingStyle: PropTypes.objectOf(PropTypes.any),\r\n  footerStyle: PropTypes.objectOf(PropTypes.any),\r\n  handleEnd: PropTypes.func,\r\n  headerComponent: PropTypes.element,\r\n  headerTitle: PropTypes.string,\r\n  height: PropTypes.string,\r\n  hideBotAvatar: PropTypes.bool,\r\n  hideHeader: PropTypes.bool,\r\n  hideSubmitButton: PropTypes.bool,\r\n  hideUserAvatar: PropTypes.bool,\r\n  inputAttributes: PropTypes.objectOf(PropTypes.any),\r\n  inputStyle: PropTypes.objectOf(PropTypes.any),\r\n  opened: PropTypes.bool,\r\n  toggleFloating: PropTypes.func,\r\n  placeholder: PropTypes.string,\r\n  recognitionEnable: PropTypes.bool,\r\n  recognitionLang: PropTypes.string,\r\n  recognitionPlaceholder: PropTypes.string,\r\n  speechSynthesis: PropTypes.shape({\r\n    enable: PropTypes.bool,\r\n    lang: PropTypes.string,\r\n    voice:\r\n      typeof window !== 'undefined'\r\n        ? PropTypes.instanceOf(window.SpeechSynthesisVoice)\r\n        : PropTypes.any\r\n  }),\r\n  steps: PropTypes.arrayOf(PropTypes.object).isRequired,\r\n  style: PropTypes.objectOf(PropTypes.any),\r\n  submitButtonStyle: PropTypes.objectOf(PropTypes.any),\r\n  userAvatar: PropTypes.string,\r\n  userDelay: PropTypes.number,\r\n  width: PropTypes.string\r\n};\r\n\r\nChatBot.defaultProps = {\r\n  avatarStyle: {},\r\n  botDelay: 1000,\r\n  botName: 'The bot',\r\n  bubbleOptionStyle: {},\r\n  bubbleStyle: {},\r\n  cache: false,\r\n  cacheName: 'rsc_cache',\r\n  className: '',\r\n  contentStyle: {},\r\n  customStyle: {},\r\n  controlStyle: { position: 'absolute', right: '0', top: '0' },\r\n  customDelay: 1000,\r\n  enableMobileAutoFocus: false,\r\n  enableSmoothScroll: false,\r\n  extraControl: undefined,\r\n  floating: false,\r\n  floatingIcon: <ChatIcon />,\r\n  floatingStyle: {},\r\n  footerStyle: {},\r\n  handleEnd: undefined,\r\n  headerComponent: undefined,\r\n  headerTitle: 'Chat',\r\n  height: '520px',\r\n  hideBotAvatar: false,\r\n  hideHeader: false,\r\n  hideSubmitButton: false,\r\n  hideUserAvatar: false,\r\n  inputStyle: {},\r\n  opened: undefined,\r\n  placeholder: 'Type the message ...',\r\n  inputAttributes: {},\r\n  recognitionEnable: false,\r\n  recognitionLang: 'en',\r\n  recognitionPlaceholder: 'Listening ...',\r\n  speechSynthesis: {\r\n    enable: false,\r\n    lang: 'en',\r\n    voice: null\r\n  },\r\n  style: {},\r\n  submitButtonStyle: {},\r\n  toggleFloating: undefined,\r\n  userDelay: 1000,\r\n  width: '350px',\r\n  botAvatar:\r\n    \"data:image/svg+xml,%3csvg version='1' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3e%3cpath d='M303 70a47 47 0 1 0-70 40v84h46v-84c14-8 24-23 24-40z' fill='%2393c7ef'/%3e%3cpath d='M256 23v171h23v-84a47 47 0 0 0-23-87z' fill='%235a8bb0'/%3e%3cpath fill='%2393c7ef' d='M0 240h248v124H0z'/%3e%3cpath fill='%235a8bb0' d='M264 240h248v124H264z'/%3e%3cpath fill='%2393c7ef' d='M186 365h140v124H186z'/%3e%3cpath fill='%235a8bb0' d='M256 365h70v124h-70z'/%3e%3cpath fill='%23cce9f9' d='M47 163h419v279H47z'/%3e%3cpath fill='%2393c7ef' d='M256 163h209v279H256z'/%3e%3cpath d='M194 272a31 31 0 0 1-62 0c0-18 14-32 31-32s31 14 31 32z' fill='%233c5d76'/%3e%3cpath d='M380 272a31 31 0 0 1-62 0c0-18 14-32 31-32s31 14 31 32z' fill='%231e2e3b'/%3e%3cpath d='M186 349a70 70 0 1 0 140 0H186z' fill='%233c5d76'/%3e%3cpath d='M256 349v70c39 0 70-31 70-70h-70z' fill='%231e2e3b'/%3e%3c/svg%3e\",\r\n  userAvatar:\r\n    \"data:image/svg+xml,%3csvg viewBox='-208.5 21 100 100' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3ccircle cx='-158.5' cy='71' fill='%23F5EEE5' r='50'/%3e%3cdefs%3e%3ccircle cx='-158.5' cy='71' id='a' r='50'/%3e%3c/defs%3e%3cclipPath id='b'%3e%3cuse overflow='visible' xlink:href='%23a'/%3e%3c/clipPath%3e%3cpath clip-path='url(%23b)' d='M-108.5 121v-14s-21.2-4.9-28-6.7c-2.5-.7-7-3.3-7-12V82h-30v6.3c0 8.7-4.5 11.3-7 12-6.8 1.9-28.1 7.3-28.1 6.7v14h100.1z' fill='%23E6C19C'/%3e%3cg clip-path='url(%23b)'%3e%3cdefs%3e%3cpath d='M-108.5 121v-14s-21.2-4.9-28-6.7c-2.5-.7-7-3.3-7-12V82h-30v6.3c0 8.7-4.5 11.3-7 12-6.8 1.9-28.1 7.3-28.1 6.7v14h100.1z' id='c'/%3e%3c/defs%3e%3cclipPath id='d'%3e%3cuse overflow='visible' xlink:href='%23c'/%3e%3c/clipPath%3e%3cpath clip-path='url(%23d)' d='M-158.5 100.1c12.7 0 23-18.6 23-34.4 0-16.2-10.3-24.7-23-24.7s-23 8.5-23 24.7c0 15.8 10.3 34.4 23 34.4z' fill='%23D4B08C'/%3e%3c/g%3e%3cpath d='M-158.5 96c12.7 0 23-16.3 23-31 0-15.1-10.3-23-23-23s-23 7.9-23 23c0 14.7 10.3 31 23 31z' fill='%23F2CEA5'/%3e%3c/svg%3e\"\r\n};\r\n\r\nexport default ChatBot;\r\n"]},"metadata":{},"sourceType":"module"}